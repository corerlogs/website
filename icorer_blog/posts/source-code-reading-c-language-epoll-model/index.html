<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=icon type=image/ico sizes=16x16 href=/icorer_blog/img/favicon.ico><meta property="og:image" content="https://res.cloudinary.com/malloc/image/upload/v1669271757/icorer.com/34047788_pepere.jpg"><title>源码阅读：C语言epoll模型 | 笔迹-工匠之芯</title><meta name=author content="LB"><meta name=description content="背景epoll是Linux内核为处理大批量文件描述符而作了改进的poll，是Linux下多路复用IO接口select/poll的增强版本，它能显著提高程序在大量并发连接中只有少量活跃的情况下的系统CPU利用率。另一点原因就是获取事件的时候，它无须遍历整个被侦听的描述符集，只要遍历那些被内核IO事件异步唤醒而加入Ready队列的描述符集合就行了。epoll除了提供select/poll那种IO事件的水平触发（Level Triggered）外，还提供了边缘触发（Edge Triggered），这就使得用户空间程序有可能缓存IO状态，减少epoll_wait/epoll_pwait的调用，提高应用程序效率。
#模型代码 今天给大家分享一下EPOLL的相关模型代码：
服务端代码 1#include <sys/types.h> 2#include <sys/signalfd.h> 3#include <sys/epoll.h> 4#include <errno.h> 5#include <poll.h> 6#include <signal.h> 7#include <limits.h> 8#include <stdio.h> 9#include <stdlib.h> 10#include <unistd.h> 11#include <fcntl.h> 12#include <string.h> 13#include <assert.h> 14#include <sys/ioctl.h> 15#include <sys/socket.h> 16#include <netinet/in.h> 17#include <arpa/inet.h> 18#include &#34;utarray.h&#34; 19 20/***************************************************************************** 21 * This program demonstrates epoll-based event notification. It monitors for 22 * new client connections, input on existing connections or their closure, as 23 * well as signals."><meta name=keywords content="blog,博客,工匠之芯,笔迹-工匠之芯"><meta name=twitter:card content="summary"><meta name=twitter:title content="源码阅读：C语言epoll模型 "><meta name=twitter:description content="背景epoll是Linux内核为处理大批量文件描述符而作了改进的poll，是Linux下多路复用IO接口select/poll的增强版本，它能显著提高程序在大量并发连接中只有少量活跃的情况下的系统CPU利用率。另一点原因就是获取事件的时候，它无须遍历整个被侦听的描述符集，只要遍历那些被内核IO事件异步唤醒而加入Ready队列的描述符集合就行了。epoll除了提供select/poll那种IO事件的水平触发（Level Triggered）外，还提供了边缘触发（Edge Triggered），这就使得用户空间程序有可能缓存IO状态，减少epoll_wait/epoll_pwait的调用，提高应用程序效率。
#模型代码 今天给大家分享一下EPOLL的相关模型代码：
服务端代码 1#include <sys/types.h> 2#include <sys/signalfd.h> 3#include <sys/epoll.h> 4#include <errno.h> 5#include <poll.h> 6#include <signal.h> 7#include <limits.h> 8#include <stdio.h> 9#include <stdlib.h> 10#include <unistd.h> 11#include <fcntl.h> 12#include <string.h> 13#include <assert.h> 14#include <sys/ioctl.h> 15#include <sys/socket.h> 16#include <netinet/in.h> 17#include <arpa/inet.h> 18#include &#34;utarray.h&#34; 19 20/***************************************************************************** 21 * This program demonstrates epoll-based event notification. It monitors for 22 * new client connections, input on existing connections or their closure, as 23 * well as signals."><meta property="og:title" content="源码阅读：C语言epoll模型 "><meta property="og:description" content="背景epoll是Linux内核为处理大批量文件描述符而作了改进的poll，是Linux下多路复用IO接口select/poll的增强版本，它能显著提高程序在大量并发连接中只有少量活跃的情况下的系统CPU利用率。另一点原因就是获取事件的时候，它无须遍历整个被侦听的描述符集，只要遍历那些被内核IO事件异步唤醒而加入Ready队列的描述符集合就行了。epoll除了提供select/poll那种IO事件的水平触发（Level Triggered）外，还提供了边缘触发（Edge Triggered），这就使得用户空间程序有可能缓存IO状态，减少epoll_wait/epoll_pwait的调用，提高应用程序效率。
#模型代码 今天给大家分享一下EPOLL的相关模型代码：
服务端代码 1#include <sys/types.h> 2#include <sys/signalfd.h> 3#include <sys/epoll.h> 4#include <errno.h> 5#include <poll.h> 6#include <signal.h> 7#include <limits.h> 8#include <stdio.h> 9#include <stdlib.h> 10#include <unistd.h> 11#include <fcntl.h> 12#include <string.h> 13#include <assert.h> 14#include <sys/ioctl.h> 15#include <sys/socket.h> 16#include <netinet/in.h> 17#include <arpa/inet.h> 18#include &#34;utarray.h&#34; 19 20/***************************************************************************** 21 * This program demonstrates epoll-based event notification. It monitors for 22 * new client connections, input on existing connections or their closure, as 23 * well as signals."><meta property="og:type" content="article"><meta property="og:url" content="https://icorer.com/icorer_blog/posts/source-code-reading-c-language-epoll-model/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-06-08T18:02:18+08:00"><meta property="article:modified_time" content="2018-06-08T18:02:18+08:00"><link rel=stylesheet href=/icorer_blog/css/bootstrap.min.css crossorigin=anonymous><link href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/icorer_blog/sass/main.css><link rel=stylesheet href=/icorer_blog/zoomjs/zoom.min.css><script src=/icorer_blog/js/lazysizes.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/icorer_blog/apple-touch-icon.png><link rel=manifest href=/icorer_blog/site.webmanifest></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://icorer.com/icorer_blog/>笔迹-工匠之芯</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=https://icorer.com title=工匠之芯>工匠之芯</a></li><li><a href=https://icorer.com/icorer_about title=关于我>关于我</a></li><li><a href=https://github.com/gitsrc title=开源仓库>开源仓库</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder=内容搜索...></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/icorer_blog/tags/clang/ title=CLang>CLang</a>
<a class=tag href=/icorer_blog/tags/epoll/ title=epoll>epoll</a>
<a class=tag href=/icorer_blog/tags/%E5%BA%95%E5%B1%82%E7%A0%94%E7%A9%B6/ title=底层研究>底层研究</a></div><h1>源码阅读：C语言epoll模型</h1><h2 class=subheading></h2><span class=meta>Posted by LB
on Fri, Jun 8, 2018</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><h1 id=背景>背景<a class=anchorjs-link href=#%e8%83%8c%e6%99%af></a></h1><p>epoll是Linux内核为处理大批量文件描述符而作了改进的poll，是Linux下多路复用IO接口select/poll的增强版本，它能显著提高程序在大量并发连接中只有少量活跃的情况下的系统CPU利用率。另一点原因就是获取事件的时候，它无须遍历整个被侦听的描述符集，只要遍历那些被内核IO事件异步唤醒而加入Ready队列的描述符集合就行了。epoll除了提供select/poll那种IO事件的水平触发（Level Triggered）外，还提供了边缘触发（Edge Triggered），这就使得用户空间程序有可能缓存IO状态，减少epoll_wait/epoll_pwait的调用，提高应用程序效率。</p><p>#模型代码
今天给大家分享一下EPOLL的相关模型代码：</p><h2 id=服务端代码>服务端代码<a class=anchorjs-link href=#%e6%9c%8d%e5%8a%a1%e7%ab%af%e4%bb%a3%e7%a0%81></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/types.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/signalfd.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/epoll.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;errno.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;poll.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;signal.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;limits.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdio.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdlib.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;unistd.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;fcntl.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;string.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;assert.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/ioctl.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/socket.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;netinet/in.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;arpa/inet.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;utarray.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20</span><span><span style=color:#6272a4>/*****************************************************************************
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21</span><span><span style=color:#6272a4> * This program demonstrates epoll-based event notification. It monitors for
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22</span><span><span style=color:#6272a4> * new client connections, input on existing connections or their closure, as
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23</span><span><span style=color:#6272a4> * well as signals. The signals are also accepted via a file descriptor using
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24</span><span><span style=color:#6272a4> * signalfd. This program uses blocking I/O in all cases. The epoll mechanism
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25</span><span><span style=color:#6272a4> * tell us which exactly which descriptor is ready, when it is ready, so there
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26</span><span><span style=color:#6272a4> * is no need for speculative/non-blocking reads. This program is more
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27</span><span><span style=color:#6272a4> * efficient than sigio-server.c.
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28</span><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29</span><span><span style=color:#6272a4> * Troy D. Hanson
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30</span><span><span style=color:#6272a4> ****************************************************************************/</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32</span><span><span style=color:#ff79c6>struct</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33</span><span>  <span style=color:#8be9fd>in_addr_t</span> addr;    <span style=color:#6272a4>/* local IP or INADDR_ANY   */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34</span><span>  <span style=color:#8be9fd>int</span> port;          <span style=color:#6272a4>/* local port to listen on  */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35</span><span>  <span style=color:#8be9fd>int</span> fd;            <span style=color:#6272a4>/* listener descriptor      */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36</span><span>  UT_array <span style=color:#ff79c6>*</span>fds;     <span style=color:#6272a4>/* array of client descriptors */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37</span><span>  <span style=color:#8be9fd>int</span> signal_fd;     <span style=color:#6272a4>/* used to receive signals  */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38</span><span>  <span style=color:#8be9fd>int</span> epoll_fd;      <span style=color:#6272a4>/* used for all notification*/</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39</span><span>  <span style=color:#8be9fd>int</span> verbose;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40</span><span>  <span style=color:#8be9fd>int</span> ticks;         <span style=color:#6272a4>/* uptime in seconds        */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41</span><span>  <span style=color:#8be9fd>int</span> pid;           <span style=color:#6272a4>/* our own pid              */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42</span><span>  <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>prog;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43</span><span>} cfg <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44</span><span>  .addr <span style=color:#ff79c6>=</span> INADDR_ANY, <span style=color:#6272a4>/* by default, listen on all local IP&#39;s   */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45</span><span>  .fd <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46</span><span>  .signal_fd <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47</span><span>  .epoll_fd <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>usage</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51</span><span>  <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;usage: %s [-v] [-a &lt;ip&gt;] -p &lt;port</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, cfg.prog);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52</span><span>  <span style=color:#50fa7b>exit</span>(<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55</span><span><span style=color:#6272a4>/* do periodic work here */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>periodic</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57</span><span>  <span style=color:#ff79c6>if</span> (cfg.verbose) <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;up %d seconds</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, cfg.ticks);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>add_epoll</span>(<span style=color:#8be9fd>int</span> events, <span style=color:#8be9fd>int</span> fd) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61</span><span>  <span style=color:#8be9fd>int</span> rc;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62</span><span>  <span style=color:#ff79c6>struct</span> epoll_event ev;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63</span><span>  <span style=color:#50fa7b>memset</span>(<span style=color:#ff79c6>&amp;</span>ev,<span style=color:#bd93f9>0</span>,<span style=color:#ff79c6>sizeof</span>(ev)); <span style=color:#6272a4>// placate valgrind
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64</span><span><span style=color:#6272a4></span>  ev.events <span style=color:#ff79c6>=</span> events;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65</span><span>  ev.data.fd<span style=color:#ff79c6>=</span> fd;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66</span><span>  <span style=color:#ff79c6>if</span> (cfg.verbose) <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;adding fd %d to epoll</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67</span><span>  rc <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>epoll_ctl</span>(cfg.epoll_fd, EPOLL_CTL_ADD, fd, <span style=color:#ff79c6>&amp;</span>ev);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68</span><span>  <span style=color:#ff79c6>if</span> (rc <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69</span><span>    <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;epoll_ctl: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>strerror</span>(errno));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71</span><span>  <span style=color:#ff79c6>return</span> rc;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>del_epoll</span>(<span style=color:#8be9fd>int</span> fd) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75</span><span>  <span style=color:#8be9fd>int</span> rc;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76</span><span>  <span style=color:#ff79c6>struct</span> epoll_event ev;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77</span><span>  rc <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>epoll_ctl</span>(cfg.epoll_fd, EPOLL_CTL_DEL, fd, <span style=color:#ff79c6>&amp;</span>ev);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78</span><span>  <span style=color:#ff79c6>if</span> (rc <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79</span><span>    <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;epoll_ctl: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>strerror</span>(errno));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81</span><span>  <span style=color:#ff79c6>return</span> rc;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84</span><span><span style=color:#6272a4>/* signals that we&#39;ll accept synchronously via signalfd */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85</span><span><span style=color:#8be9fd>int</span> sigs[] <span style=color:#ff79c6>=</span> {SIGIO,SIGHUP,SIGTERM,SIGINT,SIGQUIT,SIGALRM};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>setup_listener</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88</span><span>  <span style=color:#8be9fd>int</span> rc <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>, one<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90</span><span>  <span style=color:#8be9fd>int</span> fd <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>socket</span>(AF_INET, SOCK_STREAM, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91</span><span>  <span style=color:#ff79c6>if</span> (fd <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92</span><span>    <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;socket: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>strerror</span>(errno));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93</span><span>    <span style=color:#ff79c6>goto</span> done;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96</span><span>  <span style=color:#6272a4>/**********************************************************
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97</span><span><span style=color:#6272a4>   * internet socket address structure: our address and port
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98</span><span><span style=color:#6272a4>   *********************************************************/</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99</span><span>  <span style=color:#ff79c6>struct</span> sockaddr_in sin;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100</span><span>  sin.sin_family <span style=color:#ff79c6>=</span> AF_INET;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101</span><span>  sin.sin_addr.s_addr <span style=color:#ff79c6>=</span> cfg.addr;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102</span><span>  sin.sin_port <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>htons</span>(cfg.port);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104</span><span>  <span style=color:#6272a4>/**********************************************************
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105</span><span><span style=color:#6272a4>   * bind socket to address and port 
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106</span><span><span style=color:#6272a4>   *********************************************************/</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107</span><span>  <span style=color:#50fa7b>setsockopt</span>(fd, SOL_SOCKET, SO_REUSEADDR, <span style=color:#ff79c6>&amp;</span>one, <span style=color:#ff79c6>sizeof</span>(one));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108</span><span>  <span style=color:#ff79c6>if</span> (<span style=color:#50fa7b>bind</span>(fd, (<span style=color:#ff79c6>struct</span> sockaddr<span style=color:#ff79c6>*</span>)<span style=color:#ff79c6>&amp;</span>sin, <span style=color:#ff79c6>sizeof</span>(sin)) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109</span><span>    <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;bind: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>strerror</span>(errno));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110</span><span>    <span style=color:#ff79c6>goto</span> done;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113</span><span>  <span style=color:#6272a4>/**********************************************************
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114</span><span><span style=color:#6272a4>   * put socket into listening state
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115</span><span><span style=color:#6272a4>   *********************************************************/</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116</span><span>  <span style=color:#ff79c6>if</span> (<span style=color:#50fa7b>listen</span>(fd,<span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117</span><span>    <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;listen: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>strerror</span>(errno));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118</span><span>    <span style=color:#ff79c6>goto</span> done;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121</span><span>  cfg.fd <span style=color:#ff79c6>=</span> fd;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122</span><span>  rc<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124</span><span> <span style=color:#8be9fd;font-style:italic>done</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125</span><span>  <span style=color:#ff79c6>if</span> ((rc <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>&amp;&amp;</span> (fd <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)) <span style=color:#50fa7b>close</span>(fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126</span><span>  <span style=color:#ff79c6>return</span> rc;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129</span><span><span style=color:#6272a4>/* accept a new client connection to the listening socket */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>accept_client</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131</span><span>  <span style=color:#8be9fd>int</span> fd;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132</span><span>  <span style=color:#ff79c6>struct</span> sockaddr_in in;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133</span><span>  <span style=color:#8be9fd>socklen_t</span> sz <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>sizeof</span>(in);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135</span><span>  fd <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>accept</span>(cfg.fd,(<span style=color:#ff79c6>struct</span> sockaddr<span style=color:#ff79c6>*</span>)<span style=color:#ff79c6>&amp;</span>in, <span style=color:#ff79c6>&amp;</span>sz);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136</span><span>  <span style=color:#ff79c6>if</span> (fd <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137</span><span>    <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;accept: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>strerror</span>(errno)); 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138</span><span>    <span style=color:#ff79c6>goto</span> done;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141</span><span>  <span style=color:#ff79c6>if</span> (cfg.verbose <span style=color:#ff79c6>&amp;&amp;</span> (<span style=color:#ff79c6>sizeof</span>(in)<span style=color:#ff79c6>==</span>sz)) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142</span><span>    <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;connection fd %d from %s:%d</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, fd,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143</span><span>    <span style=color:#50fa7b>inet_ntoa</span>(in.sin_addr), (<span style=color:#8be9fd>int</span>)<span style=color:#50fa7b>ntohs</span>(in.sin_port));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146</span><span>  <span style=color:#ff79c6>if</span> (<span style=color:#50fa7b>add_epoll</span>(EPOLLIN, fd) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) { <span style=color:#50fa7b>close</span>(fd); fd <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>; }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148</span><span> <span style=color:#8be9fd;font-style:italic>done</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149</span><span>  <span style=color:#ff79c6>if</span> (fd <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) <span style=color:#50fa7b>utarray_push_back</span>(cfg.fds,<span style=color:#ff79c6>&amp;</span>fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150</span><span>  <span style=color:#ff79c6>return</span> fd;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>drain_client</span>(<span style=color:#8be9fd>int</span> fd) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154</span><span>  <span style=color:#8be9fd>int</span> rc, pos, <span style=color:#ff79c6>*</span>fp;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155</span><span>  <span style=color:#8be9fd>char</span> buf[<span style=color:#bd93f9>1024</span>];
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157</span><span>  rc <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>read</span>(fd, buf, <span style=color:#ff79c6>sizeof</span>(buf));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158</span><span>  <span style=color:#ff79c6>switch</span>(rc) { 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159</span><span>    <span style=color:#ff79c6>default</span><span style=color:#ff79c6>:</span> <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;received %d bytes</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, rc);         <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160</span><span>    <span style=color:#ff79c6>case</span>  <span style=color:#bd93f9>0</span><span style=color:#ff79c6>:</span> <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;fd %d closed</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, fd);              <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161</span><span>    <span style=color:#ff79c6>case</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span><span style=color:#ff79c6>:</span> <span style=color:#50fa7b>fprintf</span>(stderr, <span style=color:#f1fa8c>&#34;recv: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>strerror</span>(errno));    <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164</span><span>  <span style=color:#ff79c6>if</span> (rc <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166</span><span>  <span style=color:#6272a4>/* client closed. log it, tell epoll to forget it, close it */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167</span><span>  <span style=color:#ff79c6>if</span> (cfg.verbose) <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;client %d has closed</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168</span><span>  <span style=color:#50fa7b>del_epoll</span>(fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169</span><span>  <span style=color:#50fa7b>close</span>(fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171</span><span>  <span style=color:#6272a4>/* delete record of fd. linear scan. want hash if lots of fds */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172</span><span>  fp<span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>NULL</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173</span><span>  <span style=color:#ff79c6>while</span> ( (fp<span style=color:#ff79c6>=</span>(<span style=color:#8be9fd>int</span><span style=color:#ff79c6>*</span>)<span style=color:#50fa7b>utarray_next</span>(cfg.fds,fp))) { 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174</span><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>*</span>fp <span style=color:#ff79c6>!=</span> fd) <span style=color:#ff79c6>continue</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175</span><span>    pos <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>utarray_eltidx</span>(cfg.fds,fp);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">176</span><span>    <span style=color:#50fa7b>utarray_erase</span>(cfg.fds,pos,<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">177</span><span>    <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">178</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">179</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">180</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">181</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">182</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>int</span> argc, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>argv[]) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">183</span><span>  cfg.prog <span style=color:#ff79c6>=</span> argv[<span style=color:#bd93f9>0</span>];
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">184</span><span>  cfg.prog<span style=color:#ff79c6>=</span>argv[<span style=color:#bd93f9>0</span>];
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">185</span><span>  cfg.pid <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>getpid</span>();
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">186</span><span>  <span style=color:#8be9fd>int</span> n, opt, <span style=color:#ff79c6>*</span>fd;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">187</span><span>  <span style=color:#ff79c6>struct</span> epoll_event ev;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">188</span><span>  <span style=color:#ff79c6>struct</span> signalfd_siginfo info;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">189</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">190</span><span>  <span style=color:#50fa7b>utarray_new</span>(cfg.fds,<span style=color:#ff79c6>&amp;</span>ut_int_icd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">191</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">192</span><span>  <span style=color:#ff79c6>while</span> ( (opt<span style=color:#ff79c6>=</span><span style=color:#50fa7b>getopt</span>(argc,argv,<span style=color:#f1fa8c>&#34;vp:a:h&#34;</span>)) <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">193</span><span>    <span style=color:#ff79c6>switch</span>(opt) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">194</span><span>      <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#39;v&#39;</span><span style=color:#ff79c6>:</span> cfg.verbose<span style=color:#ff79c6>++</span>; <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">195</span><span>      <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#39;p&#39;</span><span style=color:#ff79c6>:</span> cfg.port<span style=color:#ff79c6>=</span><span style=color:#50fa7b>atoi</span>(optarg); <span style=color:#ff79c6>break</span>; 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">196</span><span>      <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#39;a&#39;</span><span style=color:#ff79c6>:</span> cfg.addr<span style=color:#ff79c6>=</span><span style=color:#50fa7b>inet_addr</span>(optarg); <span style=color:#ff79c6>break</span>; 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">197</span><span>      <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#39;h&#39;</span><span style=color:#ff79c6>:</span> <span style=color:#ff79c6>default</span><span style=color:#ff79c6>:</span> <span style=color:#50fa7b>usage</span>(); <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">198</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">199</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">200</span><span>  <span style=color:#ff79c6>if</span> (cfg.addr <span style=color:#ff79c6>==</span> INADDR_NONE) <span style=color:#50fa7b>usage</span>();
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">201</span><span>  <span style=color:#ff79c6>if</span> (cfg.port<span style=color:#ff79c6>==</span><span style=color:#bd93f9>0</span>) <span style=color:#50fa7b>usage</span>();
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">202</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">203</span><span>  <span style=color:#6272a4>/* block all signals. we take signals synchronously via signalfd */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">204</span><span>  <span style=color:#8be9fd>sigset_t</span> all;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">205</span><span>  <span style=color:#50fa7b>sigfillset</span>(<span style=color:#ff79c6>&amp;</span>all);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">206</span><span>  <span style=color:#50fa7b>sigprocmask</span>(SIG_SETMASK,<span style=color:#ff79c6>&amp;</span>all,<span style=color:#8be9fd;font-style:italic>NULL</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">207</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">208</span><span>  <span style=color:#6272a4>/* a few signals we&#39;ll accept via our signalfd */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">209</span><span>  <span style=color:#8be9fd>sigset_t</span> sw;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">210</span><span>  <span style=color:#50fa7b>sigemptyset</span>(<span style=color:#ff79c6>&amp;</span>sw);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">211</span><span>  <span style=color:#ff79c6>for</span>(n<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>; n <span style=color:#ff79c6>&lt;</span> <span style=color:#ff79c6>sizeof</span>(sigs)<span style=color:#ff79c6>/</span><span style=color:#ff79c6>sizeof</span>(<span style=color:#ff79c6>*</span>sigs); n<span style=color:#ff79c6>++</span>) <span style=color:#50fa7b>sigaddset</span>(<span style=color:#ff79c6>&amp;</span>sw, sigs[n]);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">212</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">213</span><span>  <span style=color:#ff79c6>if</span> (<span style=color:#50fa7b>setup_listener</span>()) <span style=color:#ff79c6>goto</span> done;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">214</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">215</span><span>  <span style=color:#6272a4>/* create the signalfd for receiving signals */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">216</span><span>  cfg.signal_fd <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>signalfd</span>(<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>, <span style=color:#ff79c6>&amp;</span>sw, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">217</span><span>  <span style=color:#ff79c6>if</span> (cfg.signal_fd <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">218</span><span>    <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;signalfd: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>strerror</span>(errno));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">219</span><span>    <span style=color:#ff79c6>goto</span> done;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">220</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">221</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">222</span><span>  <span style=color:#6272a4>/* set up the epoll instance */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">223</span><span>  cfg.epoll_fd <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>epoll_create</span>(<span style=color:#bd93f9>1</span>); 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">224</span><span>  <span style=color:#ff79c6>if</span> (cfg.epoll_fd <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">225</span><span>    <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;epoll: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>strerror</span>(errno));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">226</span><span>    <span style=color:#ff79c6>goto</span> done;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">227</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">228</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">229</span><span>  <span style=color:#6272a4>/* add descriptors of interest */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">230</span><span>  <span style=color:#ff79c6>if</span> (<span style=color:#50fa7b>add_epoll</span>(EPOLLIN, cfg.fd))        <span style=color:#ff79c6>goto</span> done; <span style=color:#6272a4>// listening socket
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">231</span><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>if</span> (<span style=color:#50fa7b>add_epoll</span>(EPOLLIN, cfg.signal_fd)) <span style=color:#ff79c6>goto</span> done; <span style=color:#6272a4>// signal socket
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">232</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">233</span><span>  <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">234</span><span><span style=color:#6272a4>   * This is our main loop. epoll for input or signals.
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">235</span><span><span style=color:#6272a4>   */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">236</span><span>  <span style=color:#50fa7b>alarm</span>(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">237</span><span>  <span style=color:#ff79c6>while</span> (<span style=color:#50fa7b>epoll_wait</span>(cfg.epoll_fd, <span style=color:#ff79c6>&amp;</span>ev, <span style=color:#bd93f9>1</span>, <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">238</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">239</span><span>    <span style=color:#6272a4>/* if a signal was sent to us, read its signalfd_siginfo */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">240</span><span>    <span style=color:#ff79c6>if</span> (ev.data.fd <span style=color:#ff79c6>==</span> cfg.signal_fd) { 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">241</span><span>      <span style=color:#ff79c6>if</span> (<span style=color:#50fa7b>read</span>(cfg.signal_fd, <span style=color:#ff79c6>&amp;</span>info, <span style=color:#ff79c6>sizeof</span>(info)) <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>sizeof</span>(info)) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">242</span><span>        <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;failed to read signal fd buffer</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">243</span><span>        <span style=color:#ff79c6>continue</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">244</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">245</span><span>      <span style=color:#ff79c6>switch</span> (info.ssi_signo) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">246</span><span>        <span style=color:#ff79c6>case</span> <span style=color:#8be9fd;font-style:italic>SIGALRM</span>: 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">247</span><span>          <span style=color:#ff79c6>if</span> ((<span style=color:#ff79c6>++</span>cfg.ticks <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>10</span>) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>) <span style=color:#50fa7b>periodic</span>(); 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">248</span><span>          <span style=color:#50fa7b>alarm</span>(<span style=color:#bd93f9>1</span>); 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">249</span><span>          <span style=color:#ff79c6>continue</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">250</span><span>        <span style=color:#ff79c6>default</span><span style=color:#ff79c6>:</span>  <span style=color:#6272a4>/* exit */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">251</span><span>          <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;got signal %d</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, info.ssi_signo);  
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">252</span><span>          <span style=color:#ff79c6>goto</span> done;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">253</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">254</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">255</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">256</span><span>    <span style=color:#6272a4>/* regular POLLIN. handle the particular descriptor that&#39;s ready */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">257</span><span>    <span style=color:#50fa7b>assert</span>(ev.events <span style=color:#ff79c6>&amp;</span> EPOLLIN);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">258</span><span>    <span style=color:#ff79c6>if</span> (cfg.verbose) <span style=color:#50fa7b>fprintf</span>(stderr,<span style=color:#f1fa8c>&#34;handle POLLIN on fd %d</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, ev.data.fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">259</span><span>    <span style=color:#ff79c6>if</span> (ev.data.fd <span style=color:#ff79c6>==</span> cfg.fd) <span style=color:#50fa7b>accept_client</span>();
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">260</span><span>    <span style=color:#ff79c6>else</span> <span style=color:#50fa7b>drain_client</span>(ev.data.fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">261</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">262</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">263</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">264</span><span>  <span style=color:#50fa7b>fprintf</span>(stderr, <span style=color:#f1fa8c>&#34;epoll_wait: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>strerror</span>(errno));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">265</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">266</span><span> <span style=color:#8be9fd;font-style:italic>done</span>:   <span style=color:#6272a4>/* we get here if we got a signal like Ctrl-C */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">267</span><span>  fd<span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>NULL</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">268</span><span>  <span style=color:#ff79c6>while</span> ( (fd<span style=color:#ff79c6>=</span>(<span style=color:#8be9fd>int</span><span style=color:#ff79c6>*</span>)<span style=color:#50fa7b>utarray_next</span>(cfg.fds,fd))) {<span style=color:#50fa7b>del_epoll</span>(<span style=color:#ff79c6>*</span>fd); <span style=color:#50fa7b>close</span>(<span style=color:#ff79c6>*</span>fd);}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">269</span><span>  <span style=color:#50fa7b>utarray_free</span>(cfg.fds);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">270</span><span>  <span style=color:#ff79c6>if</span> (cfg.fd <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) <span style=color:#50fa7b>close</span>(cfg.fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">271</span><span>  <span style=color:#ff79c6>if</span> (cfg.epoll_fd <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) <span style=color:#50fa7b>close</span>(cfg.epoll_fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">272</span><span>  <span style=color:#ff79c6>if</span> (cfg.signal_fd <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) <span style=color:#50fa7b>close</span>(cfg.signal_fd);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">273</span><span>  <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">274</span><span>}
</span></span></code></pre></div><h2 id=utarray头文件>utarray头文件<a class=anchorjs-link href=#utarray%e5%a4%b4%e6%96%87%e4%bb%b6></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1</span><span><span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2</span><span><span style=color:#6272a4>Copyright (c) 2008-2014, Troy D. Hanson   http://troydhanson.github.com/uthash/
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3</span><span><span style=color:#6272a4>All rights reserved.
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4</span><span><span style=color:#6272a4>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5</span><span><span style=color:#6272a4>Redistribution and use in source and binary forms, with or without
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6</span><span><span style=color:#6272a4>modification, are permitted provided that the following conditions are met:
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7</span><span><span style=color:#6272a4>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8</span><span><span style=color:#6272a4>    * Redistributions of source code must retain the above copyright
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9</span><span><span style=color:#6272a4>      notice, this list of conditions and the following disclaimer.
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10</span><span><span style=color:#6272a4>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11</span><span><span style=color:#6272a4>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &#34;AS
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12</span><span><span style=color:#6272a4>IS&#34; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13</span><span><span style=color:#6272a4>TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14</span><span><span style=color:#6272a4>PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15</span><span><span style=color:#6272a4>OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16</span><span><span style=color:#6272a4>EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17</span><span><span style=color:#6272a4>PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18</span><span><span style=color:#6272a4>PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19</span><span><span style=color:#6272a4>LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20</span><span><span style=color:#6272a4>NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21</span><span><span style=color:#6272a4>SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22</span><span><span style=color:#6272a4>*/</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24</span><span><span style=color:#6272a4>/* a dynamic array implementation using macros 
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25</span><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26</span><span><span style=color:#ff79c6>#ifndef UTARRAY_H
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27</span><span><span style=color:#ff79c6>#define UTARRAY_H
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29</span><span><span style=color:#ff79c6>#define UTARRAY_VERSION 1.9.9
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31</span><span><span style=color:#ff79c6>#ifdef __GNUC__
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32</span><span><span style=color:#ff79c6>#define _UNUSED_ __attribute__ ((__unused__)) 
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33</span><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34</span><span><span style=color:#ff79c6>#define _UNUSED_ 
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35</span><span><span style=color:#ff79c6>#endif
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stddef.h&gt;  /* size_t */</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;string.h&gt;  /* memset, etc */</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdlib.h&gt;  /* exit */</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41</span><span><span style=color:#ff79c6>#define oom() exit(-1)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43</span><span><span style=color:#ff79c6>typedef</span> <span style=color:#50fa7b>void</span> (ctor_f)(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>dst, <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>src);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44</span><span><span style=color:#ff79c6>typedef</span> <span style=color:#50fa7b>void</span> (dtor_f)(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>elt);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45</span><span><span style=color:#ff79c6>typedef</span> <span style=color:#50fa7b>void</span> (init_f)(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>elt);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46</span><span><span style=color:#ff79c6>typedef</span> <span style=color:#ff79c6>struct</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47</span><span>    <span style=color:#8be9fd>size_t</span> sz;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48</span><span>    init_f <span style=color:#ff79c6>*</span>init;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49</span><span>    ctor_f <span style=color:#ff79c6>*</span>copy;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50</span><span>    dtor_f <span style=color:#ff79c6>*</span>dtor;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51</span><span>} UT_icd;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53</span><span><span style=color:#ff79c6>typedef</span> <span style=color:#ff79c6>struct</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54</span><span>    <span style=color:#8be9fd>unsigned</span> i,n;<span style=color:#6272a4>/* i: index of next available slot, n: num slots */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55</span><span>    UT_icd icd;  <span style=color:#6272a4>/* initializer, copy and destructor functions */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56</span><span>    <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>d;     <span style=color:#6272a4>/* n slots of size icd-&gt;sz*/</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57</span><span>} UT_array;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59</span><span><span style=color:#ff79c6>#define utarray_init(a,_icd) do {                                             \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60</span><span><span style=color:#ff79c6>  memset(a,0,sizeof(UT_array));                                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61</span><span><span style=color:#ff79c6>  (a)-&gt;icd=*_icd;                                                             \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64</span><span><span style=color:#ff79c6>#define utarray_done(a) do {                                                  \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65</span><span><span style=color:#ff79c6>  if ((a)-&gt;n) {                                                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66</span><span><span style=color:#ff79c6>    if ((a)-&gt;icd.dtor) {                                                      \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67</span><span><span style=color:#ff79c6>      size_t _ut_i;                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68</span><span><span style=color:#ff79c6>      for(_ut_i=0; _ut_i &lt; (a)-&gt;i; _ut_i++) {                                 \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69</span><span><span style=color:#ff79c6>        (a)-&gt;icd.dtor(utarray_eltptr(a,_ut_i));                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70</span><span><span style=color:#ff79c6>      }                                                                       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71</span><span><span style=color:#ff79c6>    }                                                                         \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72</span><span><span style=color:#ff79c6>    free((a)-&gt;d);                                                             \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73</span><span><span style=color:#ff79c6>  }                                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74</span><span><span style=color:#ff79c6>  (a)-&gt;n=0;                                                                   \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77</span><span><span style=color:#ff79c6>#define utarray_new(a,_icd) do {                                              \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78</span><span><span style=color:#ff79c6>  a=(UT_array*)malloc(sizeof(UT_array));                                      \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79</span><span><span style=color:#ff79c6>  utarray_init(a,_icd);                                                       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82</span><span><span style=color:#ff79c6>#define utarray_free(a) do {                                                  \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83</span><span><span style=color:#ff79c6>  utarray_done(a);                                                            \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84</span><span><span style=color:#ff79c6>  free(a);                                                                    \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87</span><span><span style=color:#ff79c6>#define utarray_reserve(a,by) do {                                            \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88</span><span><span style=color:#ff79c6>  if (((a)-&gt;i+by) &gt; ((a)-&gt;n)) {                                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89</span><span><span style=color:#ff79c6>    while(((a)-&gt;i+by) &gt; ((a)-&gt;n)) { (a)-&gt;n = ((a)-&gt;n ? (2*(a)-&gt;n) : 8); }     \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90</span><span><span style=color:#ff79c6>    if ( ((a)-&gt;d=(char*)realloc((a)-&gt;d, (a)-&gt;n*(a)-&gt;icd.sz)) == NULL) oom();  \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91</span><span><span style=color:#ff79c6>  }                                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94</span><span><span style=color:#ff79c6>#define utarray_push_back(a,p) do {                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95</span><span><span style=color:#ff79c6>  utarray_reserve(a,1);                                                       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96</span><span><span style=color:#ff79c6>  if ((a)-&gt;icd.copy) { (a)-&gt;icd.copy( _utarray_eltptr(a,(a)-&gt;i++), p); }      \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97</span><span><span style=color:#ff79c6>  else { memcpy(_utarray_eltptr(a,(a)-&gt;i++), p, (a)-&gt;icd.sz); };              \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100</span><span><span style=color:#ff79c6>#define utarray_pop_back(a) do {                                              \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101</span><span><span style=color:#ff79c6>  if ((a)-&gt;icd.dtor) { (a)-&gt;icd.dtor( _utarray_eltptr(a,--((a)-&gt;i))); }       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102</span><span><span style=color:#ff79c6>  else { (a)-&gt;i--; }                                                          \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105</span><span><span style=color:#ff79c6>#define utarray_extend_back(a) do {                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106</span><span><span style=color:#ff79c6>  utarray_reserve(a,1);                                                       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107</span><span><span style=color:#ff79c6>  if ((a)-&gt;icd.init) { (a)-&gt;icd.init(_utarray_eltptr(a,(a)-&gt;i)); }            \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108</span><span><span style=color:#ff79c6>  else { memset(_utarray_eltptr(a,(a)-&gt;i),0,(a)-&gt;icd.sz); }                   \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109</span><span><span style=color:#ff79c6>  (a)-&gt;i++;                                                                   \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112</span><span><span style=color:#ff79c6>#define utarray_len(a) ((a)-&gt;i)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114</span><span><span style=color:#ff79c6>#define utarray_eltptr(a,j) (((j) &lt; (a)-&gt;i) ? _utarray_eltptr(a,j) : NULL)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115</span><span><span style=color:#ff79c6>#define _utarray_eltptr(a,j) ((char*)((a)-&gt;d + ((a)-&gt;icd.sz*(j) )))
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117</span><span><span style=color:#ff79c6>#define utarray_insert(a,p,j) do {                                            \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118</span><span><span style=color:#ff79c6>  if (j &gt; (a)-&gt;i) utarray_resize(a,j);                                        \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119</span><span><span style=color:#ff79c6>  utarray_reserve(a,1);                                                       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120</span><span><span style=color:#ff79c6>  if ((j) &lt; (a)-&gt;i) {                                                         \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121</span><span><span style=color:#ff79c6>    memmove( _utarray_eltptr(a,(j)+1), _utarray_eltptr(a,j),                  \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122</span><span><span style=color:#ff79c6>             ((a)-&gt;i - (j))*((a)-&gt;icd.sz));                                   \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123</span><span><span style=color:#ff79c6>  }                                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124</span><span><span style=color:#ff79c6>  if ((a)-&gt;icd.copy) { (a)-&gt;icd.copy( _utarray_eltptr(a,j), p); }             \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125</span><span><span style=color:#ff79c6>  else { memcpy(_utarray_eltptr(a,j), p, (a)-&gt;icd.sz); };                     \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126</span><span><span style=color:#ff79c6>  (a)-&gt;i++;                                                                   \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129</span><span><span style=color:#ff79c6>#define utarray_inserta(a,w,j) do {                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130</span><span><span style=color:#ff79c6>  if (utarray_len(w) == 0) break;                                             \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131</span><span><span style=color:#ff79c6>  if (j &gt; (a)-&gt;i) utarray_resize(a,j);                                        \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132</span><span><span style=color:#ff79c6>  utarray_reserve(a,utarray_len(w));                                          \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133</span><span><span style=color:#ff79c6>  if ((j) &lt; (a)-&gt;i) {                                                         \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134</span><span><span style=color:#ff79c6>    memmove(_utarray_eltptr(a,(j)+utarray_len(w)),                            \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135</span><span><span style=color:#ff79c6>            _utarray_eltptr(a,j),                                             \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136</span><span><span style=color:#ff79c6>            ((a)-&gt;i - (j))*((a)-&gt;icd.sz));                                    \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137</span><span><span style=color:#ff79c6>  }                                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138</span><span><span style=color:#ff79c6>  if ((a)-&gt;icd.copy) {                                                        \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139</span><span><span style=color:#ff79c6>    size_t _ut_i;                                                             \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140</span><span><span style=color:#ff79c6>    for(_ut_i=0;_ut_i&lt;(w)-&gt;i;_ut_i++) {                                       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141</span><span><span style=color:#ff79c6>      (a)-&gt;icd.copy(_utarray_eltptr(a,j+_ut_i), _utarray_eltptr(w,_ut_i));    \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142</span><span><span style=color:#ff79c6>    }                                                                         \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143</span><span><span style=color:#ff79c6>  } else {                                                                    \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144</span><span><span style=color:#ff79c6>    memcpy(_utarray_eltptr(a,j), _utarray_eltptr(w,0),                        \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145</span><span><span style=color:#ff79c6>           utarray_len(w)*((a)-&gt;icd.sz));                                     \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146</span><span><span style=color:#ff79c6>  }                                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147</span><span><span style=color:#ff79c6>  (a)-&gt;i += utarray_len(w);                                                   \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150</span><span><span style=color:#ff79c6>#define utarray_resize(dst,num) do {                                          \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151</span><span><span style=color:#ff79c6>  size_t _ut_i;                                                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152</span><span><span style=color:#ff79c6>  if (dst-&gt;i &gt; (size_t)(num)) {                                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153</span><span><span style=color:#ff79c6>    if ((dst)-&gt;icd.dtor) {                                                    \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154</span><span><span style=color:#ff79c6>      for(_ut_i=num; _ut_i &lt; dst-&gt;i; _ut_i++) {                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155</span><span><span style=color:#ff79c6>        (dst)-&gt;icd.dtor(utarray_eltptr(dst,_ut_i));                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156</span><span><span style=color:#ff79c6>      }                                                                       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157</span><span><span style=color:#ff79c6>    }                                                                         \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158</span><span><span style=color:#ff79c6>  } else if (dst-&gt;i &lt; (size_t)(num)) {                                        \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159</span><span><span style=color:#ff79c6>    utarray_reserve(dst,num-dst-&gt;i);                                          \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160</span><span><span style=color:#ff79c6>    if ((dst)-&gt;icd.init) {                                                    \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161</span><span><span style=color:#ff79c6>      for(_ut_i=dst-&gt;i; _ut_i &lt; num; _ut_i++) {                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162</span><span><span style=color:#ff79c6>        (dst)-&gt;icd.init(utarray_eltptr(dst,_ut_i));                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163</span><span><span style=color:#ff79c6>      }                                                                       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164</span><span><span style=color:#ff79c6>    } else {                                                                  \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165</span><span><span style=color:#ff79c6>      memset(_utarray_eltptr(dst,dst-&gt;i),0,(dst)-&gt;icd.sz*(num-dst-&gt;i));       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166</span><span><span style=color:#ff79c6>    }                                                                         \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167</span><span><span style=color:#ff79c6>  }                                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168</span><span><span style=color:#ff79c6>  dst-&gt;i = num;                                                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171</span><span><span style=color:#ff79c6>#define utarray_concat(dst,src) do {                                          \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172</span><span><span style=color:#ff79c6>  utarray_inserta((dst),(src),utarray_len(dst));                              \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175</span><span><span style=color:#ff79c6>#define utarray_erase(a,pos,len) do {                                         \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">176</span><span><span style=color:#ff79c6>  if ((a)-&gt;icd.dtor) {                                                        \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">177</span><span><span style=color:#ff79c6>    size_t _ut_i;                                                             \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">178</span><span><span style=color:#ff79c6>    for(_ut_i=0; _ut_i &lt; len; _ut_i++) {                                      \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">179</span><span><span style=color:#ff79c6>      (a)-&gt;icd.dtor(utarray_eltptr((a),pos+_ut_i));                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">180</span><span><span style=color:#ff79c6>    }                                                                         \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">181</span><span><span style=color:#ff79c6>  }                                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">182</span><span><span style=color:#ff79c6>  if ((a)-&gt;i &gt; (pos+len)) {                                                   \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">183</span><span><span style=color:#ff79c6>    memmove( _utarray_eltptr((a),pos), _utarray_eltptr((a),pos+len),          \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">184</span><span><span style=color:#ff79c6>            (((a)-&gt;i)-(pos+len))*((a)-&gt;icd.sz));                              \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">185</span><span><span style=color:#ff79c6>  }                                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">186</span><span><span style=color:#ff79c6>  (a)-&gt;i -= (len);                                                            \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">187</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">188</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">189</span><span><span style=color:#ff79c6>#define utarray_renew(a,u) do {                                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">190</span><span><span style=color:#ff79c6>  if (a) utarray_clear(a); \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">191</span><span><span style=color:#ff79c6>  else utarray_new((a),(u));   \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">192</span><span><span style=color:#ff79c6>} while(0) 
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">193</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">194</span><span><span style=color:#ff79c6>#define utarray_clear(a) do {                                                 \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">195</span><span><span style=color:#ff79c6>  if ((a)-&gt;i &gt; 0) {                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">196</span><span><span style=color:#ff79c6>    if ((a)-&gt;icd.dtor) {                                                      \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">197</span><span><span style=color:#ff79c6>      size_t _ut_i;                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">198</span><span><span style=color:#ff79c6>      for(_ut_i=0; _ut_i &lt; (a)-&gt;i; _ut_i++) {                                 \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">199</span><span><span style=color:#ff79c6>        (a)-&gt;icd.dtor(utarray_eltptr(a,_ut_i));                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">200</span><span><span style=color:#ff79c6>      }                                                                       \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">201</span><span><span style=color:#ff79c6>    }                                                                         \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">202</span><span><span style=color:#ff79c6>    (a)-&gt;i = 0;                                                               \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">203</span><span><span style=color:#ff79c6>  }                                                                           \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">204</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">205</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">206</span><span><span style=color:#ff79c6>#define utarray_sort(a,cmp) do {                                              \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">207</span><span><span style=color:#ff79c6>  qsort((a)-&gt;d, (a)-&gt;i, (a)-&gt;icd.sz, cmp);                                    \
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">208</span><span><span style=color:#ff79c6>} while(0)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">209</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">210</span><span><span style=color:#ff79c6>#define utarray_find(a,v,cmp) bsearch((v),(a)-&gt;d,(a)-&gt;i,(a)-&gt;icd.sz,cmp)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">211</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">212</span><span><span style=color:#ff79c6>#define utarray_front(a) (((a)-&gt;i) ? (_utarray_eltptr(a,0)) : NULL)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">213</span><span><span style=color:#ff79c6>#define utarray_next(a,e) (((e)==NULL) ? utarray_front(a) : ((((a)-&gt;i) &gt; (utarray_eltidx(a,e)+1)) ? _utarray_eltptr(a,utarray_eltidx(a,e)+1) : NULL))
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">214</span><span><span style=color:#ff79c6>#define utarray_prev(a,e) (((e)==NULL) ? utarray_back(a) : ((utarray_eltidx(a,e) &gt; 0) ? _utarray_eltptr(a,utarray_eltidx(a,e)-1) : NULL))
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">215</span><span><span style=color:#ff79c6>#define utarray_back(a) (((a)-&gt;i) ? (_utarray_eltptr(a,(a)-&gt;i-1)) : NULL)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">216</span><span><span style=color:#ff79c6>#define utarray_eltidx(a,e) (((char*)(e) &gt;= (char*)((a)-&gt;d)) ? (((char*)(e) - (char*)((a)-&gt;d))/(size_t)(a)-&gt;icd.sz) : -1)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">217</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">218</span><span><span style=color:#6272a4>/* last we pre-define a few icd for common utarrays of ints and strings */</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">219</span><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>utarray_str_cpy</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>dst, <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>src) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">220</span><span>  <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>**</span>_src <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>char</span><span style=color:#ff79c6>**</span>)src, <span style=color:#ff79c6>**</span>_dst <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>char</span><span style=color:#ff79c6>**</span>)dst;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">221</span><span>  <span style=color:#ff79c6>*</span>_dst <span style=color:#ff79c6>=</span> (<span style=color:#ff79c6>*</span>_src <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>NULL</span>) <span style=color:#ff79c6>?</span> <span style=color:#8be9fd;font-style:italic>NULL</span> <span style=color:#ff79c6>:</span> <span style=color:#50fa7b>strdup</span>(<span style=color:#ff79c6>*</span>_src);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">222</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">223</span><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>utarray_str_dtor</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>elt) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">224</span><span>  <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>**</span>eltc <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>char</span><span style=color:#ff79c6>**</span>)elt;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">225</span><span>  <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>*</span>eltc) <span style=color:#50fa7b>free</span>(<span style=color:#ff79c6>*</span>eltc);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">226</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">227</span><span><span style=color:#ff79c6>static</span> <span style=color:#ff79c6>const</span> UT_icd ut_str_icd _UNUSED_ <span style=color:#ff79c6>=</span> {<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span>),<span style=color:#8be9fd;font-style:italic>NULL</span>,utarray_str_cpy,utarray_str_dtor};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">228</span><span><span style=color:#ff79c6>static</span> <span style=color:#ff79c6>const</span> UT_icd ut_int_icd _UNUSED_ <span style=color:#ff79c6>=</span> {<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>int</span>),<span style=color:#8be9fd;font-style:italic>NULL</span>,<span style=color:#8be9fd;font-style:italic>NULL</span>,<span style=color:#8be9fd;font-style:italic>NULL</span>};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">229</span><span><span style=color:#ff79c6>static</span> <span style=color:#ff79c6>const</span> UT_icd ut_ptr_icd _UNUSED_ <span style=color:#ff79c6>=</span> {<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span>),<span style=color:#8be9fd;font-style:italic>NULL</span>,<span style=color:#8be9fd;font-style:italic>NULL</span>,<span style=color:#8be9fd;font-style:italic>NULL</span>};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">230</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">231</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">232</span><span><span style=color:#ff79c6>#endif </span><span style=color:#6272a4>/* UTARRAY_H */</span><span style=color:#ff79c6>
</span></span></span></code></pre></div><p>源码来源：https://github.com/troydhanson/network/tree/master/tcp/server</p><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/icorer_blog/posts/parsing-function-calls-in-go/ data-toggle=tooltip data-placement=top title="解析 Go 中的函数调用">Previous<br><span>解析 Go 中的函数调用</span></a></li><li class=next><a href=/icorer_blog/posts/nginx-fast-cgi-cache-optimization/ data-toggle=tooltip data-placement=top title="Nginx FAST-CGI缓存优化">Next<br><span>Nginx FAST-CGI缓存优化</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/icorer_blog/tags/blockchain/>blockchain</a>
<a href=/icorer_blog/tags/clang/>CLang</a>
<a href=/icorer_blog/tags/cloudnative/>cloudnative</a>
<a href=/icorer_blog/tags/cmake/>Cmake</a>
<a href=/icorer_blog/tags/deca/>DeCA</a>
<a href=/icorer_blog/tags/dpki/>DPKI</a>
<a href=/icorer_blog/tags/drand/>drand</a>
<a href=/icorer_blog/tags/eip/>EIP</a>
<a href=/icorer_blog/tags/epoll/>epoll</a>
<a href=/icorer_blog/tags/ethereum/>Ethereum</a>
<a href=/icorer_blog/tags/fpga/>FPGA</a>
<a href=/icorer_blog/tags/gc/>GC</a>
<a href=/icorer_blog/tags/golang/>GoLang</a>
<a href=/icorer_blog/tags/hackathon/>Hackathon</a>
<a href=/icorer_blog/tags/http2/>HTTP2</a>
<a href=/icorer_blog/tags/http3/>HTTP3</a>
<a href=/icorer_blog/tags/icefiredb/>IceFireDB</a>
<a href=/icorer_blog/tags/k8s/>k8s</a>
<a href=/icorer_blog/tags/kafka/>kafka</a>
<a href=/icorer_blog/tags/layer2/>Layer2</a>
<a href=/icorer_blog/tags/linux/>linux</a>
<a href=/icorer_blog/tags/nginx/>Nginx</a>
<a href=/icorer_blog/tags/nosql/>NoSQL</a>
<a href=/icorer_blog/tags/php/>PHP</a>
<a href=/icorer_blog/tags/php-kernel/>php kernel</a>
<a href=/icorer_blog/tags/php%E5%86%85%E6%A0%B8/>PHP内核</a>
<a href=/icorer_blog/tags/quic/>QUIC</a>
<a href=/icorer_blog/tags/redis/>redis</a>
<a href=/icorer_blog/tags/sbt/>SBT</a>
<a href=/icorer_blog/tags/serverless/>serverless</a>
<a href=/icorer_blog/tags/ssi/>SSI</a>
<a href=/icorer_blog/tags/unikernel/>unikernel</a>
<a href=/icorer_blog/tags/wanxiang/>Wanxiang</a>
<a href=/icorer_blog/tags/web3/>web3</a>
<a href=/icorer_blog/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/>中间件</a>
<a href=/icorer_blog/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/>云原生</a>
<a href=/icorer_blog/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/>以太坊</a>
<a href=/icorer_blog/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/>信息安全</a>
<a href=/icorer_blog/tags/%E5%86%85%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93/>内存数据库</a>
<a href=/icorer_blog/tags/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/>内存泄漏</a>
<a href=/icorer_blog/tags/%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81/>内核源码</a>
<a href=/icorer_blog/tags/%E5%86%85%E6%A0%B8%E7%A0%94%E7%A9%B6/>内核研究</a>
<a href=/icorer_blog/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/>区块链</a>
<a href=/icorer_blog/tags/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/>垃圾回收</a>
<a href=/icorer_blog/tags/%E5%AD%98%E5%82%A8/>存储</a>
<a href=/icorer_blog/tags/%E5%AE%B9%E5%99%A8/>容器</a>
<a href=/icorer_blog/tags/%E5%BA%95%E5%B1%82%E5%BC%80%E5%8F%91/>底层开发</a>
<a href=/icorer_blog/tags/%E5%BA%95%E5%B1%82%E7%A0%94%E7%A9%B6/>底层研究</a>
<a href=/icorer_blog/tags/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/>开源项目</a>
<a href=/icorer_blog/tags/%E5%BC%82%E6%9E%84%E8%AE%A1%E7%AE%97/>异构计算</a>
<a href=/icorer_blog/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/>微服务</a>
<a href=/icorer_blog/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/>性能测试</a>
<a href=/icorer_blog/tags/%E6%8A%80%E6%9C%AF%E7%A7%91%E6%99%AE/>技术科普</a>
<a href=/icorer_blog/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF/>数据库技术</a>
<a href=/icorer_blog/tags/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/>文章翻译</a>
<a href=/icorer_blog/tags/%E6%96%B0%E6%9E%B6%E6%9E%84/>新架构</a>
<a href=/icorer_blog/tags/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/>时序数据库</a>
<a href=/icorer_blog/tags/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/>服务治理</a>
<a href=/icorer_blog/tags/%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC/>服务网格</a>
<a href=/icorer_blog/tags/%E6%9C%8D%E5%8A%A1%E9%81%A5%E6%B5%8B/>服务遥测</a>
<a href=/icorer_blog/tags/%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/>测试报告</a>
<a href=/icorer_blog/tags/%E7%A0%94%E7%A9%B6%E6%8A%A5%E5%91%8A/>研究报告</a>
<a href=/icorer_blog/tags/%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF/>缓存技术</a>
<a href=/icorer_blog/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/>网络安全</a>
<a href=/icorer_blog/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/>虚拟机</a>
<a href=/icorer_blog/tags/%E8%A1%8C%E4%B8%9A%E6%8A%A5%E5%91%8A/>行业报告</a>
<a href=/icorer_blog/tags/%E8%AE%BA%E6%96%87/>论文</a>
<a href=/icorer_blog/tags/%E9%9B%B6%E4%BF%A1%E4%BB%BB/>零信任</a>
<a href=/icorer_blog/tags/%E9%AB%98%E6%80%A7%E8%83%BD/>高性能</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=/icorer_blog/index.xml><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fa fa-rss fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/corerman1><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/gitsrc><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 笔迹-工匠之芯 2023</p></div></div></div></footer><script src=/icorer_blog/js/jquery.min.js></script>
<script src=/icorer_blog/js/bootstrap.min.js crossorigin=anonymous></script>
<script src=/icorer_blog/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script>
<script src=/icorer_blog/js/simple-jekyll-search.min.js></script>
<script src=/icorer_blog/js/search.min.7d1445cf07369bca2715d9f63738c16c73a7a2273a95d6729bee561f7e84c6c8.js></script>
<script src=/icorer_blog/zoomjs/zoom.min.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VB37D8LWFT"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VB37D8LWFT")</script></body></html>