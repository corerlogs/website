<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="PulseFlow 组件安装文档 # 一. 系统介绍 # 随着公司PHP项目体的不断增大，随着不同工程师的功能迭代，如何有效获取PHP项目的执行性能，对于系统整体模块显得异常重要，PulseFlow是一个公司团队内部自研地性能跟踪扩展，它可以在程序员无感知的情况下有效跟踪每一个函数的执行效率，主要分析CPU时间消耗、内存大小消耗，执行次数这三个指标，下面我们将从 PHP生命期 到 组件设计 到 性能优化这三个方面来进行阐述组件。
二 . PulseFLow 扩展端架构 # 2.1 功能架构 # 2.2 流程架构 # 三 . PulseFLow 后端程序架构 # 3.1 后端程序流程 # 后台数据转发程序，它负责从信息通道里读取PHP扩展写入的信息，并转发给相应的下一级程序，相关流程图如下。
3.2 后端总体架构 # 四. 系统安装手册 # （请一定按照顺序操作）
下面是详细的安装文档，目的是让阅读者能够顺利编译安装PulseFLow扩展。
4.1. 环境准备 # Centos 7系统
PHP 7.0 版本以上
4.2. 内核参数调整（编辑 /etc/sysctl.conf 文件） # 扩展依赖UDP数据包发送 和 Linux 内核消息队列，所以需要调整以下两方面参数。
特殊说明：配置完毕后 采用 sudo sysctl -p生效
4.2.1 调整UDP发送缓冲区大小 # 为了减少UDP发送丢包，因此调大UDP数据包发送缓冲区，经过实验，分配256MB就可以足够。配置选项如下
net.core.wmem_max = 268435456"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:type" content="website"><meta property="og:image" content="https://res.cloudinary.com/malloc/image/upload/v1666510486/icefiredb/logo_z8koem.png"><meta property="og:title" content="1.1 安装文档"><meta property="og:description" content="PulseFlow 组件安装文档 # 一. 系统介绍 # 随着公司PHP项目体的不断增大，随着不同工程师的功能迭代，如何有效获取PHP项目的执行性能，对于系统整体模块显得异常重要，PulseFlow是一个公司团队内部自研地性能跟踪扩展，它可以在程序员无感知的情况下有效跟踪每一个函数的执行效率，主要分析CPU时间消耗、内存大小消耗，执行次数这三个指标，下面我们将从 PHP生命期 到 组件设计 到 性能优化这三个方面来进行阐述组件。
二 . PulseFLow 扩展端架构 # 2.1 功能架构 # 2.2 流程架构 # 三 . PulseFLow 后端程序架构 # 3.1 后端程序流程 # 后台数据转发程序，它负责从信息通道里读取PHP扩展写入的信息，并转发给相应的下一级程序，相关流程图如下。
3.2 后端总体架构 # 四. 系统安装手册 # （请一定按照顺序操作）
下面是详细的安装文档，目的是让阅读者能够顺利编译安装PulseFLow扩展。
4.1. 环境准备 # Centos 7系统
PHP 7.0 版本以上
4.2. 内核参数调整（编辑 /etc/sysctl.conf 文件） # 扩展依赖UDP数据包发送 和 Linux 内核消息队列，所以需要调整以下两方面参数。
特殊说明：配置完毕后 采用 sudo sysctl -p生效
4.2.1 调整UDP发送缓冲区大小 # 为了减少UDP发送丢包，因此调大UDP数据包发送缓冲区，经过实验，分配256MB就可以足够。配置选项如下
net.core.wmem_max = 268435456"><meta property="og:type" content="article"><meta property="og:url" content="https://icorer.com/icorer_docs/doccenter/pulseflow/overviews/1.1/"><meta property="article:section" content="DocCenter"><title>1.1 安装文档 | 工匠之芯-文档中心</title><link rel=manifest href=/icorer_docs/manifest.json><link rel=icon href=/icorer_docs/favicon.ico type=image/x-icon><link rel=stylesheet href=/icorer_docs/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css integrity="sha256-RhgbyTN1upMgJudTs3xA5v+LsWqe93DHi8xmPkV3sbo=" crossorigin=anonymous><script defer src=/icorer_docs/flexsearch.min.js></script>
<script defer src=/icorer_docs/en.search.min.f940a0629f5807726a53b14a3d76872dac986d6000955ff93d3ea03a5c6ba3b5.js integrity="sha256-+UCgYp9YB3JqU7FKPXaHLayYbWAAlV/5PT6gOlxro7U=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/icorer_docs/><span>工匠之芯-文档中心</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://icorer.com/ target=_blank rel=noopener>工匠之芯</a></li><li><a href=https://github.com/gitsrc target=_blank rel=noopener>Open Source</a></li></ul><ul><li class=book-section-flat><a href=https://icorer.com/icorer_docs/doccenter/>项目总览</a><ul><li><input type=checkbox id=section-aed24396fef473497b12e93db0aa8548 class=toggle>
<label for=section-aed24396fef473497b12e93db0aa8548 class="flex justify-between"><a href=https://icorer.com/icorer_docs/doccenter/redishub/>RedisHub</a></label><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/>系统设计</a><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.1/>1.1基础运行框架</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.2/>1.2配置解析器</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.3/>1.3通信组件</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.4/>1.4 协议解析器与拦截器</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.5/>1.5 NetHandle组件</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.6/>1.5 集群 MSET 指令支持</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.7/>1.7 集群 MGET 指令支持</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.8/>1.9 Redis集群状态更新</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.9/>1.8 TCP连接池</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.10/>1.10 RESP协议解析</a></li></ul></li><li><span>系统模块测试</span><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/module_test/2.1/>2.1 NetHandle组件测试</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/module_test/2.2/>2.2 中间件完整测试</a></li></ul></li><li><span>中间件部署</span><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/deploy/3.1/>3.1 部署文档</a></li></ul></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/system_access/>系统接入</a><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/system_access/4.1/>4.1 phpredis对接redishub</a></li></ul></li></ul></li><li><input type=checkbox id=section-14e1ec26ce57d625211daa6855b123ba class=toggle>
<label for=section-14e1ec26ce57d625211daa6855b123ba class="flex justify-between"><a href=https://icorer.com/icorer_docs/doccenter/redistun/>RedisTun</a></label><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/>系统设计</a><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.1/>1.1基础运行框架</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.2/>1.2配置解析器</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.3/>1.3通信组件</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.4/>1.4 协议解析器与拦截器</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.5/>1.5 NetHandle组件</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.6/>1.5 哈希分操器组件</a></li></ul></li><li><span>系统模块测试</span><ul></ul></li><li><span>中间件部署</span><ul></ul></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/system_access/>系统接入</a><ul></ul></li></ul></li><li><input type=checkbox id=section-a22dab337e8b55a3f7712060bcd10bb9 class=toggle>
<label for=section-a22dab337e8b55a3f7712060bcd10bb9 class="flex justify-between"><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/>AK-2019</a></label><ul><li><span>系统设计</span><ul><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.1/>框架层次设计</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.2/>1.2 AK-FRAME设计-Request Handle设计</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.3/>1.3 AK-FRAME设计-Request Handle设计阐述</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.4/>1.4 权限设计-最小操作与功能单元</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.5/>1.5 权限设计-系统结构设计</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.6/>1.6 权限设计-基于Plan的权限方案设计</a></li></ul></li></ul></li><li><input type=checkbox id=section-1453ce2c5ecb8c18c2860dade55163de class=toggle checked>
<label for=section-1453ce2c5ecb8c18c2860dade55163de class="flex justify-between"><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/>PulseFlow</a></label><ul><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/overviews/>PulseFlow概览</a><ul><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/overviews/1.1/ class=active>1.1 安装文档</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/overviews/1.2/>1.2 使用文档</a></li></ul></li><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/pulgin_designed/>PulseFlow插件端</a><ul><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/pulgin_designed/2.1/>2.1 扩展总览</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/pulgin_designed/2.2/>2.2 数据结构</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/pulgin_designed/2.3/>2.3 功能流程</a></li></ul></li><li><span>PulseFlow后台端</span><ul><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/plugin_backend/3.1/>3.1 后台总览</a></li></ul></li><li><span>运行情况</span><ul><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/run_status/4.1/>4.1 运行跟踪报告</a></li></ul></li></ul></li><li><input type=checkbox id=section-404d707d87f9ef4c7b157ec13db25c80 class=toggle>
<label for=section-404d707d87f9ef4c7b157ec13db25c80 class="flex justify-between"><a href=https://icorer.com/icorer_docs/doccenter/logdarts/>LogDarts组件风险评估</a></label><ul><li><a href=https://icorer.com/icorer_docs/doccenter/logdarts/designs/>风险分析</a><ul><li><a href=https://icorer.com/icorer_docs/doccenter/logdarts/designs/1.1/>1.1 数据结构分析</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/logdarts/designs/1.2/>1.2 代码流程分析</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/logdarts/designs/1.3/>1.3 异常监控分析</a></li></ul></li></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/icorer_docs/svg/menu.svg class=book-icon alt=Menu></label>
<strong>1.1 安装文档</strong>
<label for=toc-control><img src=/icorer_docs/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#21-功能架构>2.1 功能架构</a></li><li><a href=#22-流程架构>2.2 流程架构</a></li></ul><ul><li><a href=#31-后端程序流程>3.1 后端程序流程</a></li><li><a href=#32-后端总体架构>3.2 后端总体架构</a></li></ul><ul><li><a href=#41-环境准备>4.1. 环境准备</a></li><li><a href=#42-内核参数调整编辑-etcsysctlconf-文件>4.2. 内核参数调整（编辑 /etc/sysctl.conf 文件）</a><ul><li><a href=#421-调整udp发送缓冲区大小>4.2.1 调整UDP发送缓冲区大小</a></li><li><a href=#422-调整linux内核消息队列大小>4.2.2 调整Linux内核消息队列大小</a></li></ul></li><li><a href=#43-编译插件>4.3. 编译插件</a><ul><li><a href=#431-克隆代码>4.3.1. 克隆代码</a></li><li><a href=#432-编译安装>4.3.2. 编译安装</a></li><li><a href=#433-创建一个文件>4.3.3. 创建一个文件</a></li><li><a href=#434--修改phpini配置-不要携带注释内容>4.3.4. 修改php.ini配置 (不要携带注释内容）</a></li></ul></li></ul><ul><li><ul><li><a href=#441-克隆代码>4.4.1. 克隆代码</a></li><li><a href=#442-编译安装>4.4.2. 编译安装</a></li><li><a href=#443-配置-configini>4.4.3. 配置 config.ini</a></li><li><a href=#444-后端程序启动>4.4.4 .后端程序启动</a></li><li><a href=#445-后端程序稳定性>4.4.5 后端程序稳定性</a></li><li><a href=#446-服务器部署-注意点>4.4.6 服务器部署 注意点</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=pulseflow-组件安装文档>PulseFlow 组件安装文档
<a class=anchor href=#pulseflow-%e7%bb%84%e4%bb%b6%e5%ae%89%e8%a3%85%e6%96%87%e6%a1%a3>#</a></h1><h1 id=一-系统介绍>一. 系统介绍
<a class=anchor href=#%e4%b8%80-%e7%b3%bb%e7%bb%9f%e4%bb%8b%e7%bb%8d>#</a></h1><p>随着公司PHP项目体的不断增大，随着不同工程师的功能迭代，如何有效获取PHP项目的执行性能，对于系统整体模块显得异常重要，PulseFlow是一个公司团队内部自研地性能跟踪扩展，它可以在程序员无感知的情况下有效跟踪每一个函数的执行效率，主要分析CPU时间消耗、内存大小消耗，执行次数这三个指标，下面我们将从 PHP生命期 到 组件设计 到 性能优化这三个方面来进行阐述组件。</p><h1 id=二--pulseflow-扩展端架构>二 . PulseFLow 扩展端架构
<a class=anchor href=#%e4%ba%8c--pulseflow-%e6%89%a9%e5%b1%95%e7%ab%af%e6%9e%b6%e6%9e%84>#</a></h1><h2 id=21-功能架构>2.1 功能架构
<a class=anchor href=#21-%e5%8a%9f%e8%83%bd%e6%9e%b6%e6%9e%84>#</a></h2><p><img src=https://icorer.com/icorer_docs/uploads/pulseFLow/images/m_540b9703e82b7c4cd0bb5a3223508011_r.png alt></p><h2 id=22-流程架构>2.2 流程架构
<a class=anchor href=#22-%e6%b5%81%e7%a8%8b%e6%9e%b6%e6%9e%84>#</a></h2><p><img src=https://icorer.com/icorer_docs/uploads/pulseFLow/images/m_c5e0651657a4e3e67806d2a791afe64f_r.png alt></p><h1 id=三--pulseflow-后端程序架构>三 . PulseFLow 后端程序架构
<a class=anchor href=#%e4%b8%89--pulseflow-%e5%90%8e%e7%ab%af%e7%a8%8b%e5%ba%8f%e6%9e%b6%e6%9e%84>#</a></h1><h2 id=31-后端程序流程>3.1 后端程序流程
<a class=anchor href=#31-%e5%90%8e%e7%ab%af%e7%a8%8b%e5%ba%8f%e6%b5%81%e7%a8%8b>#</a></h2><p>后台数据转发程序，它负责从信息通道里读取PHP扩展写入的信息，并转发给相应的下一级程序，相关流程图如下。</p><p><img src=https://icorer.com/icorer_blog/img/usr/uploads/2018/08/3883690472.png alt></p><h2 id=32-后端总体架构>3.2 后端总体架构
<a class=anchor href=#32-%e5%90%8e%e7%ab%af%e6%80%bb%e4%bd%93%e6%9e%b6%e6%9e%84>#</a></h2><p><img src=https://icorer.com/icorer_docs/uploads/pulseFLow/images/m_dd52a548aeacfbb3d1bf3df128ae3780_r.png alt></p><h1 id=四-系统安装手册>四. 系统安装手册
<a class=anchor href=#%e5%9b%9b-%e7%b3%bb%e7%bb%9f%e5%ae%89%e8%a3%85%e6%89%8b%e5%86%8c>#</a></h1><p><strong>（请一定按照顺序操作）</strong></p><p>下面是详细的安装文档，目的是让阅读者能够顺利编译安装PulseFLow扩展。</p><h2 id=41-环境准备>4.1. 环境准备
<a class=anchor href=#41-%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87>#</a></h2><ol><li><p>Centos 7系统</p></li><li><p>PHP 7.0 版本以上</p></li></ol><h2 id=42-内核参数调整编辑-etcsysctlconf-文件>4.2. 内核参数调整（编辑 /etc/sysctl.conf 文件）
<a class=anchor href=#42-%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0%e8%b0%83%e6%95%b4%e7%bc%96%e8%be%91-etcsysctlconf-%e6%96%87%e4%bb%b6>#</a></h2><p>扩展依赖UDP数据包发送 和 Linux 内核消息队列，所以需要调整以下两方面参数。</p><p><strong>特殊说明</strong>：配置完毕后 采用 sudo sysctl -p生效</p><h3 id=421-调整udp发送缓冲区大小>4.2.1 调整UDP发送缓冲区大小
<a class=anchor href=#421-%e8%b0%83%e6%95%b4udp%e5%8f%91%e9%80%81%e7%bc%93%e5%86%b2%e5%8c%ba%e5%a4%a7%e5%b0%8f>#</a></h3><p>为了减少UDP发送丢包，因此调大UDP数据包发送缓冲区，经过实验，分配256MB就可以足够。配置选项如下</p><blockquote><p>net.core.wmem_max = 268435456</p></blockquote><h3 id=422-调整linux内核消息队列大小>4.2.2 调整Linux内核消息队列大小
<a class=anchor href=#422-%e8%b0%83%e6%95%b4linux%e5%86%85%e6%a0%b8%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97%e5%a4%a7%e5%b0%8f>#</a></h3><p>由于默认的Linux对于内核消息队列的相关参数普遍很小，不能满足程序运行需要，因此需要进行相关参数调整：</p><blockquote><p>kernel.msgmni = 10240</p></blockquote><blockquote><p>kernel.msgmax = 120000</p></blockquote><blockquote><p>kernel.msgmnb = 1228800000</p></blockquote><p>第一个代表调大Linux系统允许的最大消息队列数量，第二个代表调大系统允许的每条内核消息大小，第三个代表调大操作系统允许的内核消息队列总共大小。</p><p><strong>特殊说明</strong>：配置完毕后 采用 sudo sysctl -p生效</p><h2 id=43-编译插件>4.3. 编译插件
<a class=anchor href=#43-%e7%bc%96%e8%af%91%e6%8f%92%e4%bb%b6>#</a></h2><h3 id=431-克隆代码>4.3.1. 克隆代码
<a class=anchor href=#431-%e5%85%8b%e9%9a%86%e4%bb%a3%e7%a0%81>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone http://gitlab.shein.com:8088/NineWorlds/PulseFlow.git
</span></span></code></pre></div><h3 id=432-编译安装>4.3.2. 编译安装
<a class=anchor href=#432-%e7%bc%96%e8%af%91%e5%ae%89%e8%a3%85>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>
</span></span><span style=display:flex><span>phpize
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./configure  // 这行可能需要配置 --with-php-config<span style=color:#f92672>=</span>php-config文件路径
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo make install
</span></span></code></pre></div><h3 id=433-创建一个文件>4.3.3. 创建一个文件
<a class=anchor href=#433-%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa%e6%96%87%e4%bb%b6>#</a></h3><p>这个文件主要用于内核队列标识的生成，所以这个文件需要放在可以稳定存储的路径，并赋予读写权限，可以给予777权限，(文件内容可以为空) ，样例操作如下:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo touch /PulseFlow_sv_ipc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo chmod <span style=color:#ae81ff>777</span> /PulseFlow_sv_ipc
</span></span></code></pre></div><h3 id=434--修改phpini配置-不要携带注释内容>4.3.4. 修改php.ini配置 (不要携带注释内容）
<a class=anchor href=#434--%e4%bf%ae%e6%94%b9phpini%e9%85%8d%e7%bd%ae-%e4%b8%8d%e8%a6%81%e6%90%ba%e5%b8%a6%e6%b3%a8%e9%87%8a%e5%86%85%e5%ae%b9>#</a></h3><p>在文件选择空白处，添加以下配置:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>extension <span style=color:#f92672>=</span> /usr/local/php/lib/php/extensions/debug-non-zts-20170718/PulseFlow.so //扩展编译后存储的路径
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PulseFlow.enabled <span style=color:#f92672>=</span> true  //开启插件
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PulseFlow.svipc_name<span style=color:#f92672>=</span>/PulseFlow_sv_ipc  //第三步中创建的文件 的完整路径
</span></span></code></pre></div><h1 id=44-编译后端程序>4.4. 编译后端程序
<a class=anchor href=#44-%e7%bc%96%e8%af%91%e5%90%8e%e7%ab%af%e7%a8%8b%e5%ba%8f>#</a></h1><h3 id=441-克隆代码>4.4.1. 克隆代码
<a class=anchor href=#441-%e5%85%8b%e9%9a%86%e4%bb%a3%e7%a0%81>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone http://gitlab.shein.com:8088/NineWorlds/PulseFlow_IPC_Backend.git
</span></span></code></pre></div><h3 id=442-编译安装>4.4.2. 编译安装
<a class=anchor href=#442-%e7%bc%96%e8%af%91%e5%ae%89%e8%a3%85>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>
</span></span><span style=display:flex><span>cd PulseFlow_IPC_Backend
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cmake ../
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cp ../config.ini ./  
</span></span></code></pre></div><h3 id=443-配置-configini>4.4.3. 配置 config.ini
<a class=anchor href=#443-%e9%85%8d%e7%bd%ae-configini>#</a></h3><p>config.ini 包含后端程序的相关运行参数</p><ol><li><p>mode = svipc （监听System V 内核消息队列 ，v1.0.0稳定支持版本)</p></li><li><p>output =1 (是否开启终端输出，1代表开启; 0 代表关闭）</p></li><li><p>workernum = 8 （后台进程数量，推荐数字为CPU核心数的2倍)</p></li><li><p>fileuri = /PulseFlow_sv_ipc (3.3 节中的文件路径）</p></li><li><p>ip = 127.0.0.1 (发送数据包的UDP IP地址 JAVA提供）</p></li><li><p>port = 8002 (发送数据包的UDP 端口地址 JAVA提供）</p></li></ol><p>其他参数不需要调动，上述参数只需要按需改动即可。</p><h3 id=444-后端程序启动>4.4.4 .后端程序启动
<a class=anchor href=#444-%e5%90%8e%e7%ab%af%e7%a8%8b%e5%ba%8f%e5%90%af%e5%8a%a8>#</a></h3><p>终端启动程序，直接给予程序执行权限，即可运行。</p><p>推荐使用脚本启动，还需要麻烦运维小伙伴编写启动脚本。</p><h3 id=445-后端程序稳定性>4.4.5 后端程序稳定性
<a class=anchor href=#445-%e5%90%8e%e7%ab%af%e7%a8%8b%e5%ba%8f%e7%a8%b3%e5%ae%9a%e6%80%a7>#</a></h3><p>后端程序的稳定性主要围绕 <strong>主进程</strong> 和 <strong>进程池</strong> 两方面。</p><p>在<strong>程序体内部采用了主从模式</strong>，主进程会监控子进程池的状态，所有的进程名称均相同，主进程的PID是进程组的第一个数值，目前我们能够保障子进程池的稳定，如果子进程挂掉了，主进程会负责调控生成新的子进程。</p><p><strong>主进程的稳定性还需要运维小伙伴根据主进程PID做监控</strong>，如果发现主进程挂掉了，重启主进程。</p><h3 id=446-服务器部署-注意点>4.4.6 服务器部署 注意点
<a class=anchor href=#446-%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%83%a8%e7%bd%b2-%e6%b3%a8%e6%84%8f%e7%82%b9>#</a></h3><p>部署需要重启php-fpm，所以为了业务保险起见，可以先把nginx下线再重启PHP-FPM，避免业务损失。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#21-功能架构>2.1 功能架构</a></li><li><a href=#22-流程架构>2.2 流程架构</a></li></ul><ul><li><a href=#31-后端程序流程>3.1 后端程序流程</a></li><li><a href=#32-后端总体架构>3.2 后端总体架构</a></li></ul><ul><li><a href=#41-环境准备>4.1. 环境准备</a></li><li><a href=#42-内核参数调整编辑-etcsysctlconf-文件>4.2. 内核参数调整（编辑 /etc/sysctl.conf 文件）</a><ul><li><a href=#421-调整udp发送缓冲区大小>4.2.1 调整UDP发送缓冲区大小</a></li><li><a href=#422-调整linux内核消息队列大小>4.2.2 调整Linux内核消息队列大小</a></li></ul></li><li><a href=#43-编译插件>4.3. 编译插件</a><ul><li><a href=#431-克隆代码>4.3.1. 克隆代码</a></li><li><a href=#432-编译安装>4.3.2. 编译安装</a></li><li><a href=#433-创建一个文件>4.3.3. 创建一个文件</a></li><li><a href=#434--修改phpini配置-不要携带注释内容>4.3.4. 修改php.ini配置 (不要携带注释内容）</a></li></ul></li></ul><ul><li><ul><li><a href=#441-克隆代码>4.4.1. 克隆代码</a></li><li><a href=#442-编译安装>4.4.2. 编译安装</a></li><li><a href=#443-配置-configini>4.4.3. 配置 config.ini</a></li><li><a href=#444-后端程序启动>4.4.4 .后端程序启动</a></li><li><a href=#445-后端程序稳定性>4.4.5 后端程序稳定性</a></li><li><a href=#446-服务器部署-注意点>4.4.6 服务器部署 注意点</a></li></ul></li></ul></nav></div></aside></main></body></html>