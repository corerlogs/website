<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>系统接入 on 工匠之芯-文档中心</title><link>https://icorer.com/icorer_docs/doccenter/redishub/system_access/</link><description>Recent content in 系统接入 on 工匠之芯-文档中心</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><atom:link href="https://icorer.com/icorer_docs/doccenter/redishub/system_access/index.xml" rel="self" type="application/rss+xml"/><item><title>4.1 phpredis对接redishub</title><link>https://icorer.com/icorer_docs/doccenter/redishub/system_access/4.1/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://icorer.com/icorer_docs/doccenter/redishub/system_access/4.1/</guid><description>phpredis 对接 RedisHub 改造方案 # 一、背景描述 # phpredis进行Redis集群化改造，对接 RedisHub 中间件，并调整phpredis底层，增加业务降级逻辑。
二、改造方案 # 2.1、Agent 连接 # 由于 RedisHub 采用 UNIX domain连接，本地部署 Agent 的方式，不存在 port端口，故 redis连接时，无法再传递该参数，需要去掉，具体连接代码如下
public function __construct($config, $prefix = &amp;#39;prefix:&amp;#39;) { $this-&amp;gt;prefixH = $prefix; $this-&amp;gt;redisconf = $config; $this-&amp;gt;redis = new \Redis(); try { $this-&amp;gt;redis-&amp;gt;connect($this-&amp;gt;redisconf[&amp;#39;host&amp;#39;]); } catch (\Exception $exception) { Logger::getInstance()-&amp;gt;error(&amp;#39;Redis agent connect error, &amp;#39; . $exception-&amp;gt;getMessage() . &amp;#39;, &amp;#39; . $this-&amp;gt;redisconf[&amp;#39;host&amp;#39;]); try { //redis集群中间件服务不可用，降级 $this-&amp;gt;redis = new \RedisCluster(null, $this-&amp;gt;redisconf[&amp;#39;cluster&amp;#39;][&amp;#39;node&amp;#39;], $this-&amp;gt;redisconf[&amp;#39;cluster&amp;#39;][&amp;#39;timeout&amp;#39;], $this-&amp;gt;redisconf[&amp;#39;cluster&amp;#39;][&amp;#39;readTimeout&amp;#39;], $this-&amp;gt;redisconf[&amp;#39;cluster&amp;#39;][&amp;#39;persistent&amp;#39;]); } catch (\Exception $exception) { Logger::getInstance()-&amp;gt;error(&amp;#39;RedisCluster connect error, &amp;#39; .</description></item></channel></rss>