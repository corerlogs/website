<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="零、亿级数据压测 # // 测试脚本 <?php $redis = new Redis(); try { //connect 是 异常级别 $redis->connect('/tmp/redis.socks'); $ret = $redis->set(&#34;hello&#34;, &#34;helloworld&#34;,2); var_dump($ret); $ret = $redis->get(&#34;hello&#34;); var_dump($ret); $ret = $redis->del(&#34;hello&#34;); var_dump($ret); $ret = $redis->mset([&#34;test1&#34; => 'value1', &#34;test2&#34; => 'value2']); var_dump($ret); $ret = $redis->del(&#34;test1&#34;, &#34;test2&#34;, &#34;test3&#34;); var_dump($ret); $ret = $redis->mget([&#34;test1&#34;, &#34;test2&#34;, &#34;test3&#34;, &#34;test4&#34;, &#34;test5&#34;, &#34;test6&#34;, &#34;test7&#34;, &#34;test8&#34;, &#34;test9&#34;, &#34;test10&#34;, &#34;test11&#34;, &#34;test12&#34;, &#34;test13&#34;, &#34;test14&#34;, &#34;test15&#34;, &#34;test16&#34;, &#34;test17&#34;, &#34;test18&#34;, &#34;test19&#34;, &#34;test20&#34;]); var_dump($ret); $ret = $redis->rPush(&#34;push&#34;,&#34;key1&#34;,2019,&#34;key2&#34;); var_dump($ret); $val1 = $redis->lPop(&#34;push&#34;); var_dump($val1); $val1 = $redis->lPop(&#34;push&#34;); var_dump($val1); $val1 = $redis->lPop(&#34;push&#34;); var_dump($val1); } catch (\Exception $ex) { var_dump($ex->getMessage()); } # 终端输出 ______ _ _ _ _ _ (_____ \ | (_) (_) (_) | | _____) )_____ __| |_ ___ _______ _ _| |__ | __ /| ___ |/ _ | |/___) ___ | | | | _ \ | | \ \| ____( (_| | |___ | | | | |_| | |_) ) |_| |_|_____)\____|_(___/|_| |_|____/|____/ 2019/09/15 09:40:27 main."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:type" content="website"><meta property="og:image" content="https://res.cloudinary.com/malloc/image/upload/v1666510486/icefiredb/logo_z8koem.png"><meta property="og:title" content="2.2 中间件完整测试"><meta property="og:description" content="零、亿级数据压测 # // 测试脚本 <?php $redis = new Redis(); try { //connect 是 异常级别 $redis->connect('/tmp/redis.socks'); $ret = $redis->set(&#34;hello&#34;, &#34;helloworld&#34;,2); var_dump($ret); $ret = $redis->get(&#34;hello&#34;); var_dump($ret); $ret = $redis->del(&#34;hello&#34;); var_dump($ret); $ret = $redis->mset([&#34;test1&#34; => 'value1', &#34;test2&#34; => 'value2']); var_dump($ret); $ret = $redis->del(&#34;test1&#34;, &#34;test2&#34;, &#34;test3&#34;); var_dump($ret); $ret = $redis->mget([&#34;test1&#34;, &#34;test2&#34;, &#34;test3&#34;, &#34;test4&#34;, &#34;test5&#34;, &#34;test6&#34;, &#34;test7&#34;, &#34;test8&#34;, &#34;test9&#34;, &#34;test10&#34;, &#34;test11&#34;, &#34;test12&#34;, &#34;test13&#34;, &#34;test14&#34;, &#34;test15&#34;, &#34;test16&#34;, &#34;test17&#34;, &#34;test18&#34;, &#34;test19&#34;, &#34;test20&#34;]); var_dump($ret); $ret = $redis->rPush(&#34;push&#34;,&#34;key1&#34;,2019,&#34;key2&#34;); var_dump($ret); $val1 = $redis->lPop(&#34;push&#34;); var_dump($val1); $val1 = $redis->lPop(&#34;push&#34;); var_dump($val1); $val1 = $redis->lPop(&#34;push&#34;); var_dump($val1); } catch (\Exception $ex) { var_dump($ex->getMessage()); } # 终端输出 ______ _ _ _ _ _ (_____ \ | (_) (_) (_) | | _____) )_____ __| |_ ___ _______ _ _| |__ | __ /| ___ |/ _ | |/___) ___ | | | | _ \ | | \ \| ____( (_| | |___ | | | | |_| | |_) ) |_| |_|_____)\____|_(___/|_| |_|____/|____/ 2019/09/15 09:40:27 main."><meta property="og:type" content="article"><meta property="og:url" content="https://icorer.com/icorer_docs/doccenter/redishub/module_test/2.2/"><meta property="article:section" content="DocCenter"><title>2.2 中间件完整测试 | 工匠之芯-文档中心</title><link rel=manifest href=/icorer_docs/manifest.json><link rel=icon href=/icorer_docs/favicon.ico type=image/x-icon><link rel=stylesheet href=/icorer_docs/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css integrity="sha256-RhgbyTN1upMgJudTs3xA5v+LsWqe93DHi8xmPkV3sbo=" crossorigin=anonymous><script defer src=/icorer_docs/flexsearch.min.js></script>
<script defer src=/icorer_docs/en.search.min.eabd1a1e842c3a713f4f0e30647ac9a26dbd69dd0defd9bbd76b3be177fcaf4a.js integrity="sha256-6r0aHoQsOnE/Tw4wZHrJom29ad0N79m712s74Xf8r0o=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/icorer_docs/><span>工匠之芯-文档中心</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://icorer.com/ target=_blank rel=noopener>工匠之芯</a></li><li><a href=https://github.com/gitsrc target=_blank rel=noopener>Open Source</a></li></ul><ul><li class=book-section-flat><a href=https://icorer.com/icorer_docs/doccenter/>项目总览</a><ul><li><input type=checkbox id=section-aed24396fef473497b12e93db0aa8548 class=toggle checked>
<label for=section-aed24396fef473497b12e93db0aa8548 class="flex justify-between"><a href=https://icorer.com/icorer_docs/doccenter/redishub/>RedisHub</a></label><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/>系统设计</a><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.1/>1.1基础运行框架</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.2/>1.2配置解析器</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.3/>1.3通信组件</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.4/>1.4 协议解析器与拦截器</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.5/>1.5 NetHandle组件</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.6/>1.5 集群 MSET 指令支持</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.7/>1.7 集群 MGET 指令支持</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.8/>1.9 Redis集群状态更新</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.9/>1.8 TCP连接池</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/designs/1.10/>1.10 RESP协议解析</a></li></ul></li><li><span>系统模块测试</span><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/module_test/2.1/>2.1 NetHandle组件测试</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/module_test/2.2/ class=active>2.2 中间件完整测试</a></li></ul></li><li><span>中间件部署</span><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/deploy/3.1/>3.1 部署文档</a></li></ul></li><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/system_access/>系统接入</a><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redishub/system_access/4.1/>4.1 phpredis对接redishub</a></li></ul></li></ul></li><li><input type=checkbox id=section-14e1ec26ce57d625211daa6855b123ba class=toggle>
<label for=section-14e1ec26ce57d625211daa6855b123ba class="flex justify-between"><a href=https://icorer.com/icorer_docs/doccenter/redistun/>RedisTun</a></label><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/>系统设计</a><ul><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.1/>1.1基础运行框架</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.2/>1.2配置解析器</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.3/>1.3通信组件</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.4/>1.4 协议解析器与拦截器</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.5/>1.5 NetHandle组件</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/designs/1.6/>1.5 哈希分操器组件</a></li></ul></li><li><span>系统模块测试</span><ul></ul></li><li><span>中间件部署</span><ul></ul></li><li><a href=https://icorer.com/icorer_docs/doccenter/redistun/system_access/>系统接入</a><ul></ul></li></ul></li><li><input type=checkbox id=section-a22dab337e8b55a3f7712060bcd10bb9 class=toggle>
<label for=section-a22dab337e8b55a3f7712060bcd10bb9 class="flex justify-between"><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/>AK-2019</a></label><ul><li><span>系统设计</span><ul><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.1/>框架层次设计</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.2/>1.2 AK-FRAME设计-Request Handle设计</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.3/>1.3 AK-FRAME设计-Request Handle设计阐述</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.4/>1.4 权限设计-最小操作与功能单元</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.5/>1.5 权限设计-系统结构设计</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/ak-2019/designs/1.6/>1.6 权限设计-基于Plan的权限方案设计</a></li></ul></li></ul></li><li><input type=checkbox id=section-1453ce2c5ecb8c18c2860dade55163de class=toggle>
<label for=section-1453ce2c5ecb8c18c2860dade55163de class="flex justify-between"><a role=button>PulseFlow</a></label><ul><li><input type=checkbox id=section-b349698f86361cb77fa3daf6029bb134 class=toggle>
<label for=section-b349698f86361cb77fa3daf6029bb134 class="flex justify-between"><a role=button>Architecture</a></label><ul><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/architecture/overview/>OverView</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/architecture/network/>NetWork</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/architecture/storage/>Storage</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/architecture/protocol/>Protocol</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/pulseflow/architecture/codec/>Codec</a></li></ul></li></ul></li><li><input type=checkbox id=section-404d707d87f9ef4c7b157ec13db25c80 class=toggle>
<label for=section-404d707d87f9ef4c7b157ec13db25c80 class="flex justify-between"><a role=button>LogDarts</a></label><ul><li><input type=checkbox id=section-658ed1b71722eedc365fde2c5579594f class=toggle>
<label for=section-658ed1b71722eedc365fde2c5579594f class="flex justify-between"><a role=button>Architecture</a></label><ul><li><a href=https://icorer.com/icorer_docs/doccenter/logdarts/architecture/overview/>OverView</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/logdarts/architecture/network/>NetWork</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/logdarts/architecture/storage/>Storage</a></li><li><a href=https://icorer.com/icorer_docs/doccenter/logdarts/architecture/protocol/>Protocol</a></li></ul></li></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/icorer_docs/svg/menu.svg class=book-icon alt=Menu></label>
<strong>2.2 中间件完整测试</strong>
<label for=toc-control><img src=/icorer_docs/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#零亿级数据压测>零、亿级数据压测</a></li><li><a href=#一redis基准压测性能对比>一、Redis基准压测性能对比</a></li><li><a href=#二-中间件和标准集群下phpredis的表现及性能>二. 中间件和标准集群下，phpredis的表现及性能</a></li></ul></li></ul><ul><li><a href=#一-set指令-保持一致>一. set指令 （保持一致）</a></li><li><a href=#二mset-保持一致>二、mset （保持一致）</a></li><li><a href=#三get-保持一致>三、get （保持一致）</a></li><li><a href=#四mget-节点损坏时有区别redishub更合理>四、mget （节点损坏时有区别，redishub更合理）</a><ul><li><a href=#五del>五、DEL</a></li><li><a href=#六rpush指令-保持一致>六.rpush指令 （保持一致）</a></li><li><a href=#七lpop指令-保持一致>七.lpop指令 （保持一致）</a></li></ul></li></ul></nav></aside></header><article class=markdown><h3 id=零亿级数据压测>零、亿级数据压测
<a class=anchor href=#%e9%9b%b6%e4%ba%bf%e7%ba%a7%e6%95%b0%e6%8d%ae%e5%8e%8b%e6%b5%8b>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// 测试脚本
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;hello&#34;</span>, <span style=color:#e6db74>&#34;helloworld&#34;</span>,<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;hello&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>del</span>(<span style=color:#e6db74>&#34;hello&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>mset</span>([<span style=color:#e6db74>&#34;test1&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;value1&#39;</span>, <span style=color:#e6db74>&#34;test2&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;value2&#39;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>del</span>(<span style=color:#e6db74>&#34;test1&#34;</span>, <span style=color:#e6db74>&#34;test2&#34;</span>, <span style=color:#e6db74>&#34;test3&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>mget</span>([<span style=color:#e6db74>&#34;test1&#34;</span>, <span style=color:#e6db74>&#34;test2&#34;</span>, <span style=color:#e6db74>&#34;test3&#34;</span>, <span style=color:#e6db74>&#34;test4&#34;</span>, <span style=color:#e6db74>&#34;test5&#34;</span>, <span style=color:#e6db74>&#34;test6&#34;</span>, <span style=color:#e6db74>&#34;test7&#34;</span>, <span style=color:#e6db74>&#34;test8&#34;</span>, <span style=color:#e6db74>&#34;test9&#34;</span>, <span style=color:#e6db74>&#34;test10&#34;</span>, <span style=color:#e6db74>&#34;test11&#34;</span>, <span style=color:#e6db74>&#34;test12&#34;</span>, <span style=color:#e6db74>&#34;test13&#34;</span>, <span style=color:#e6db74>&#34;test14&#34;</span>, <span style=color:#e6db74>&#34;test15&#34;</span>, <span style=color:#e6db74>&#34;test16&#34;</span>, <span style=color:#e6db74>&#34;test17&#34;</span>, <span style=color:#e6db74>&#34;test18&#34;</span>, <span style=color:#e6db74>&#34;test19&#34;</span>, <span style=color:#e6db74>&#34;test20&#34;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>rPush</span>(<span style=color:#e6db74>&#34;push&#34;</span>,<span style=color:#e6db74>&#34;key1&#34;</span>,<span style=color:#ae81ff>2019</span>,<span style=color:#e6db74>&#34;key2&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $val1 <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lPop</span>(<span style=color:#e6db74>&#34;push&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($val1);
</span></span><span style=display:flex><span>    $val1 <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lPop</span>(<span style=color:#e6db74>&#34;push&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($val1);
</span></span><span style=display:flex><span>    $val1 <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lPop</span>(<span style=color:#e6db74>&#34;push&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($val1);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 终端输出</span>
</span></span><span style=display:flex><span> ______            _ _      _     _       _     
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>_____ <span style=color:#ae81ff>\ </span>         | <span style=color:#f92672>(</span>_<span style=color:#f92672>)</span>    <span style=color:#f92672>(</span>_<span style=color:#f92672>)</span>   <span style=color:#f92672>(</span>_<span style=color:#f92672>)</span>     | |    
</span></span><span style=display:flex><span> _____<span style=color:#f92672>)</span> <span style=color:#f92672>)</span>_____  __| |_  ___ _______ _   _| |__  
</span></span><span style=display:flex><span>|  __  /| ___ |/ _  | |/___<span style=color:#f92672>)</span>  ___  | | | |  _ <span style=color:#ae81ff>\ </span>
</span></span><span style=display:flex><span>| |  <span style=color:#ae81ff>\ \|</span> ____<span style=color:#f92672>(</span> <span style=color:#f92672>(</span>_| | |___ | |   | | |_| | |_<span style=color:#f92672>)</span> <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_|   |_|_____<span style=color:#f92672>)</span><span style=color:#ae81ff>\_</span>___|_<span style=color:#f92672>(</span>___/|_|   |_|____/|____/ 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2019/09/15 09:40:27 main.go:69: UNIX-Server: /tmp/redis.socks
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;RedisHub Heart-Beat-Report running.&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:40:27.222+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;RedisHub-UNIX begin running&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:40:27.222+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  1978910&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:42:27.222+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  3674420&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:44:27.222+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  7971749&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:46:27.223+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  13502078&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:48:27.223+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  19082608&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:50:27.224+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  24676646&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:52:27.224+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  30279296&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:54:27.225+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  35869386&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:56:27.225+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  41462169&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T09:58:27.226+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  47037700&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:00:27.227+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  52639532&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:02:27.227+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  58224711&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:04:27.229+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  63814850&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:06:27.229+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  69385735&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:08:27.229+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  74981851&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:10:27.230+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  80565352&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:12:27.230+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  86114343&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:14:27.231+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  91721982&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:16:27.231+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  97338179&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:18:27.231+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  102913090&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:20:27.231+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  102913090&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:22:27.232+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  102913090&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:24:27.232+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  102913090&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:26:27.233+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  102913100&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:28:27.233+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  102913270&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:30:27.340+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  102913270&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:32:27.341+0800&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;appName&#34;</span>:<span style=color:#e6db74>&#34;RedisHub&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;corerman-WorkStation&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;heartbeat report info: command parse count :  102913270&#34;</span>,<span style=color:#e6db74>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2019-09-15T10:34:27.341+0800&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=一redis基准压测性能对比>一、Redis基准压测性能对比
<a class=anchor href=#%e4%b8%80redis%e5%9f%ba%e5%87%86%e5%8e%8b%e6%b5%8b%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>corerman@corerman-WorkStation:~$ redis-benchmark -p <span style=color:#ae81ff>6379</span> -t get,set,rpush,lpop,setex,psetex,del -n <span style=color:#ae81ff>200000</span> -c <span style=color:#ae81ff>50</span> -q
</span></span><span style=display:flex><span>SET: 129785.85 requests per second
</span></span><span style=display:flex><span>GET: 128865.98 requests per second
</span></span><span style=display:flex><span>RPUSH: 131839.16 requests per second
</span></span><span style=display:flex><span>LPOP: 131061.59 requests per second
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ redis-benchmark -s /tmp/redis.socks -t get,set,rpush,lpop,setex,psetex,del -n <span style=color:#ae81ff>200000</span> -c <span style=color:#ae81ff>50</span> -q
</span></span><span style=display:flex><span>SET: 116754.23 requests per second
</span></span><span style=display:flex><span>GET: 105932.20 requests per second
</span></span><span style=display:flex><span>RPUSH: 116686.12 requests per second
</span></span><span style=display:flex><span>LPOP: 105652.41 requests per second
</span></span></code></pre></div><p>通过上面可以看出，SET、GET、RPUSH、LPOP性能损耗不大</p><h3 id=二-中间件和标准集群下phpredis的表现及性能>二. 中间件和标准集群下，phpredis的表现及性能
<a class=anchor href=#%e4%ba%8c-%e4%b8%ad%e9%97%b4%e4%bb%b6%e5%92%8c%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4%e4%b8%8bphpredis%e7%9a%84%e8%a1%a8%e7%8e%b0%e5%8f%8a%e6%80%a7%e8%83%bd>#</a></h3><p>phpredis 5.0.2版本 需要在php.ini 中增加 <code>redis.clusters.cache_slots = 1</code>，开启redis集群的slots信息缓存，总而提升性能。</p><h4 id=21-set指令-ok>2.1 SET指令 （OK）
<a class=anchor href=#21-set%e6%8c%87%e4%bb%a4-ok>#</a></h4><h5 id=211-中间件>2.1.1 中间件
<a class=anchor href=#211-%e4%b8%ad%e9%97%b4%e4%bb%b6>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>   <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   $status <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;test&#34;</span>,<span style=color:#e6db74>&#34;testval&#34;</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>var_dump</span>($status);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(true)</p><h5 id=212-标准集群>2.1.2 标准集群
<a class=anchor href=#212-%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redisCluster <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RedisCluster</span>(<span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>Array</span>(<span style=color:#e6db74>&#34;127.0.0.1:9001&#34;</span>), <span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>1.5</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $status <span style=color:#f92672>=</span> $redisCluster<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;test&#34;</span>,<span style=color:#e6db74>&#34;testval&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($status);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(true)</p><h5 id=213-压测数据对比>2.1.3 压测数据对比
<a class=anchor href=#213-%e5%8e%8b%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#中间件</span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_agent.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_agent.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>11</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   6.229 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19000000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1100000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    16054.15 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.246 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.062 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          2978.80 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># phpredis直连标准集群 ： 开启slot缓存</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>11</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   5.609 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19000000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1100000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    17829.52 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.122 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.056 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3308.21 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.0      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.0      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>212</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.0      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#75715e># phpredis直连标准集群 ： 未开启slot缓存</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>11</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   10.369 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19000000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1100000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    9643.96 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       2.074 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.104 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          1789.41 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   3.2      <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1018</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>1</span>    <span style=color:#ae81ff>2</span>   4.1      <span style=color:#ae81ff>2</span>     <span style=color:#ae81ff>214</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>1</span>    <span style=color:#ae81ff>2</span>   4.1      <span style=color:#ae81ff>2</span>     <span style=color:#ae81ff>214</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>1</span>    <span style=color:#ae81ff>2</span>   5.2      <span style=color:#ae81ff>2</span>    <span style=color:#ae81ff>1021</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%   <span style=color:#ae81ff>1021</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=22-setex指令-ok>2.2 SETEX指令 （OK）
<a class=anchor href=#22-setex%e6%8c%87%e4%bb%a4-ok>#</a></h4><h5 id=221-中间件>2.2.1 中间件
<a class=anchor href=#221-%e4%b8%ad%e9%97%b4%e4%bb%b6>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $status <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;test&#34;</span>,<span style=color:#e6db74>&#34;testval&#34;</span><span style=color:#a6e22e>，5</span>);  <span style=color:#75715e>//内部调用setex
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>var_dump</span>($status);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(true)</p><h5 id=222-标准集群>2.2.2 标准集群
<a class=anchor href=#222-%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      $redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RedisCluster</span>(<span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>Array</span>(<span style=color:#e6db74>&#34;127.0.0.1:9001&#34;</span>), <span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>1.5</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $status <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;test&#34;</span>,<span style=color:#e6db74>&#34;testval&#34;</span><span style=color:#a6e22e>，5</span>); <span style=color:#75715e>//内部调用setex
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>var_dump</span>($status);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(true)</p><h5 id=223-压测数据对比>2.2.3 压测数据对比
<a class=anchor href=#223-%e5%8e%8b%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 中间件</span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_agent.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_agent.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>11</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   6.258 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19000000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1100000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    15979.34 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.252 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.063 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          2964.92 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.6      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>211</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.6      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>211</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.6      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>211</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>211</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 标准集群</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>11</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   5.600 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19000000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1100000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    17858.46 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.120 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.056 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3313.58 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.0      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>209</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.0      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>209</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.0      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>210</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>210</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=23-psetex指令-ok>2.3 PSETEX指令 （OK）
<a class=anchor href=#23-psetex%e6%8c%87%e4%bb%a4-ok>#</a></h4><h5 id=231-中间件>2.3.1 中间件
<a class=anchor href=#231-%e4%b8%ad%e9%97%b4%e4%bb%b6>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   $status <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;test&#34;</span>,<span style=color:#e6db74>&#34;testval&#34;</span>, [<span style=color:#e6db74>&#39;xx&#39;</span>, <span style=color:#e6db74>&#39;px&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#ae81ff>1000</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($status);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(true)</p><h5 id=232-标准集群>2.3.2 标准集群
<a class=anchor href=#232-%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redisCluster <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RedisCluster</span>(<span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>Array</span>(<span style=color:#e6db74>&#34;127.0.0.1:9001&#34;</span>), <span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>1.5</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $status <span style=color:#f92672>=</span> $redisCluster<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;test&#34;</span>,<span style=color:#e6db74>&#34;testval&#34;</span>, [<span style=color:#e6db74>&#39;xx&#39;</span>, <span style=color:#e6db74>&#39;px&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#ae81ff>1000</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($status);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(true)</p><h5 id=233-压测数据对比>2.3.3 压测数据对比
<a class=anchor href=#233-%e5%8e%8b%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 中间件</span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_agent.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_agent.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>11</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   6.265 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19000000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1100000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    15962.77 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.253 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.063 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          2961.84 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 标准集群</span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>11</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   5.696 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19000000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1100000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    17555.61 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.139 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.057 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3257.39 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>214</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>214</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>214</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>214</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=24-get指令-数据存在1kb-标准数据-ok>2.4 GET指令 （数据存在：1KB 标准数据） （OK）
<a class=anchor href=#24-get%e6%8c%87%e4%bb%a4-%e6%95%b0%e6%8d%ae%e5%ad%98%e5%9c%a81kb-%e6%a0%87%e5%87%86%e6%95%b0%e6%8d%ae-ok>#</a></h4><h5 id=241-中间件>2.4.1 中间件
<a class=anchor href=#241-%e4%b8%ad%e9%97%b4%e4%bb%b6>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;test&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>能够成功获取到1KB数据。</p><h5 id=242-标准集群>2.4.2 标准集群
<a class=anchor href=#242-%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     $redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RedisCluster</span>(<span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>Array</span>(<span style=color:#e6db74>&#34;127.0.0.1:9001&#34;</span>), <span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>1.5</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;test&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>能够成功获取到1KB数据。</p><h5 id=243-压测数据对比>2.4.3 压测数据对比
<a class=anchor href=#243-%e5%8e%8b%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 中间件</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_agent.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_agent.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>0</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   6.025 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>17900000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>0</span> bytes
</span></span><span style=display:flex><span>Requests per second:    16597.96 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.205 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.060 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          2901.40 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>214</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>214</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 标准集群</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>0</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   5.314 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>17900000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>0</span> bytes
</span></span><span style=display:flex><span>Requests per second:    18818.88 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.063 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.053 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3289.63 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>212</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=25-get指令-数据不存在-ok>2.5 GET指令 （数据不存在） （OK）
<a class=anchor href=#25-get%e6%8c%87%e4%bb%a4-%e6%95%b0%e6%8d%ae%e4%b8%8d%e5%ad%98%e5%9c%a8-ok>#</a></h4><h5 id=251-中间件>2.5.1 中间件
<a class=anchor href=#251-%e4%b8%ad%e9%97%b4%e4%bb%b6>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;test&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(false)</p><h5 id=252-标准集群>2.5.2 标准集群
<a class=anchor href=#252-%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     $redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RedisCluster</span>(<span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>Array</span>(<span style=color:#e6db74>&#34;127.0.0.1:9001&#34;</span>), <span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>1.5</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;test&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(false)</p><h5 id=253-压测数据对比>2.5.3 压测数据对比
<a class=anchor href=#253-%e5%8e%8b%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 中间件</span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_agent.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_agent.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>12</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   6.012 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19100000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1200000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    16632.40 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.202 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.060 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3102.33 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 标准集群</span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>12</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   5.313 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19100000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1200000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    18822.79 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.063 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.053 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3510.89 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.0      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>212</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.0      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>212</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.0      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=26-rpush指令--异常情况ok>2.6 RPUSH指令 （异常情况）（OK）
<a class=anchor href=#26-rpush%e6%8c%87%e4%bb%a4--%e5%bc%82%e5%b8%b8%e6%83%85%e5%86%b5ok>#</a></h4><h5 id=261-中间件>2.6.1 中间件
<a class=anchor href=#261-%e4%b8%ad%e9%97%b4%e4%bb%b6>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>rPush</span>(<span style=color:#e6db74>&#34;test&#34;</span>,<span style=color:#e6db74>&#34;val1&#34;</span>);  <span style=color:#75715e>//由于test 键已经和上面的set冲突，所以会出错
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(false)</p><h5 id=262-标准集群>2.6.2 标准集群
<a class=anchor href=#262-%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RedisCluster</span>(<span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>Array</span>(<span style=color:#e6db74>&#34;127.0.0.1:9001&#34;</span>), <span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>1.5</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>rPush</span>(<span style=color:#e6db74>&#34;test&#34;</span>,<span style=color:#e6db74>&#34;val1&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(false)</p><h5 id=263-压测数据对比>2.6.3 压测数据对比
<a class=anchor href=#263-%e5%8e%8b%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 中间件</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_agent.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_agent.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>12</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   5.777 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19100000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1200000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    17309.96 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.155 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.058 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3228.71 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.4      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.4      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.4      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 标准集群</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>12</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   5.570 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19100000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1200000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    17952.40 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.114 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.056 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3348.54 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>210</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>210</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.9      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>210</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>210</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=27-rpush指令--成功情况ok>2.7 RPUSH指令 （成功情况）（OK）
<a class=anchor href=#27-rpush%e6%8c%87%e4%bb%a4--%e6%88%90%e5%8a%9f%e6%83%85%e5%86%b5ok>#</a></h4><h5 id=271-中间件>2.7.1 中间件
<a class=anchor href=#271-%e4%b8%ad%e9%97%b4%e4%bb%b6>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>rPush</span>(<span style=color:#e6db74>&#34;pushtest1&#34;</span>,<span style=color:#e6db74>&#34;val1&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：int(1)</p><h5 id=272-标准集群>2.7.2 标准集群
<a class=anchor href=#272-%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RedisCluster</span>(<span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>Array</span>(<span style=color:#e6db74>&#34;127.0.0.1:9001&#34;</span>), <span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>1.5</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>rPush</span>(<span style=color:#e6db74>&#34;pushtest2&#34;</span>,<span style=color:#e6db74>&#34;val1&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：int(1)</p><h5 id=273-压测数据对比>2.7.3 压测数据对比
<a class=anchor href=#273-%e5%8e%8b%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 中间件  压测后计数正常</span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_agent.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_agent.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>7</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   6.132 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>99992</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>(</span>Connect: 0, Receive: 0, Length: 99992, Exceptions: 0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>18988900</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1088900</span> bytes
</span></span><span style=display:flex><span>Requests per second:    16307.69 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.226 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.061 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3024.07 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.7      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.7      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.7      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 标准集群  压测后计数正常</span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>7</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   5.558 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>99991</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>(</span>Connect: 0, Receive: 0, Length: 99991, Exceptions: 0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>18988895</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1088895</span> bytes
</span></span><span style=display:flex><span>Requests per second:    17992.50 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.112 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.056 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3336.50 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.3      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.3      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.4      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=28-lpop指令ok>2.8 LPOP指令（OK）
<a class=anchor href=#28-lpop%e6%8c%87%e4%bb%a4ok>#</a></h4><h5 id=281-中间件>2.8.1 中间件
<a class=anchor href=#281-%e4%b8%ad%e9%97%b4%e4%bb%b6>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lPop</span>(<span style=color:#e6db74>&#34;pushtest1&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>结果：可以正常消费，并且当没有数据后 返回false</p><h5 id=282-标准集群>2.8.2 标准集群
<a class=anchor href=#282-%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RedisCluster</span>(<span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>Array</span>(<span style=color:#e6db74>&#34;127.0.0.1:9001&#34;</span>), <span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>1.5</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lPop</span>(<span style=color:#e6db74>&#34;pushtest2&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>结果：可以正常消费，并且当没有数据后 返回false</p><h5 id=283-压测数据对比>2.8.3 压测数据对比
<a class=anchor href=#283-%e5%8e%8b%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 中间件</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_agent.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_agent.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>17</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   5.839 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>97496</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>(</span>Connect: 0, Receive: 0, Length: 97496, Exceptions: 0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19112520</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1212520</span> bytes
</span></span><span style=display:flex><span>Requests per second:    17126.52 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.168 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.058 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3196.59 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.7      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.7      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.7      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 标准集群</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>17</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   5.419 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>47803</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>(</span>Connect: 0, Receive: 0, Length: 47803, Exceptions: 0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>19360985</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>1460985</span> bytes
</span></span><span style=display:flex><span>Requests per second:    18453.22 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.084 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.054 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          3488.99 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>209</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>209</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   1.8      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>209</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>209</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=29-mget指令ok>2.9 MGET指令（OK）
<a class=anchor href=#29-mget%e6%8c%87%e4%bb%a4ok>#</a></h4><h5 id=291-中间件>2.9.1 中间件
<a class=anchor href=#291-%e4%b8%ad%e9%97%b4%e4%bb%b6>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>mget</span>([<span style=color:#e6db74>&#34;test1&#34;</span>,<span style=color:#e6db74>&#34;test2&#34;</span>,<span style=color:#e6db74>&#34;test3&#34;</span>,<span style=color:#e6db74>&#34;test4&#34;</span>,<span style=color:#e6db74>&#34;test5&#34;</span>,<span style=color:#e6db74>&#34;test6&#34;</span>,<span style=color:#e6db74>&#34;test7&#34;</span>,<span style=color:#e6db74>&#34;test8&#34;</span>,<span style=color:#e6db74>&#34;test9&#34;</span>,<span style=color:#e6db74>&#34;test10&#34;</span>,<span style=color:#e6db74>&#34;test11&#34;</span>,<span style=color:#e6db74>&#34;test12&#34;</span>,<span style=color:#e6db74>&#34;test13&#34;</span>,<span style=color:#e6db74>&#34;test14&#34;</span>,<span style=color:#e6db74>&#34;test15&#34;</span>,<span style=color:#e6db74>&#34;test16&#34;</span>,<span style=color:#e6db74>&#34;test17&#34;</span>,<span style=color:#e6db74>&#34;test18&#34;</span>,<span style=color:#e6db74>&#34;test19&#34;</span>,<span style=color:#e6db74>&#34;test20&#34;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：</p><pre tabindex=0><code>array(20) { [0]=&gt; string(6) &#34;value1&#34; [1]=&gt; string(6) &#34;value2&#34; [2]=&gt; bool(false) [3]=&gt; bool(false) [4]=&gt; bool(false) [5]=&gt; bool(false) [6]=&gt; bool(false) [7]=&gt; bool(false) [8]=&gt; bool(false) [9]=&gt; bool(false) [10]=&gt; bool(false) [11]=&gt; bool(false) [12]=&gt; bool(false) [13]=&gt; bool(false) [14]=&gt; bool(false) [15]=&gt; bool(false) [16]=&gt; bool(false) [17]=&gt; bool(false) [18]=&gt; bool(false) [19]=&gt; bool(false) }
</code></pre><h5 id=292-标准集群>2.9.2 标准集群
<a class=anchor href=#292-%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RedisCluster</span>(<span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>Array</span>(<span style=color:#e6db74>&#34;127.0.0.1:9001&#34;</span>), <span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>1.5</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>mget</span>([<span style=color:#e6db74>&#34;test1&#34;</span>,<span style=color:#e6db74>&#34;test2&#34;</span>,<span style=color:#e6db74>&#34;test3&#34;</span>,<span style=color:#e6db74>&#34;test4&#34;</span>,<span style=color:#e6db74>&#34;test5&#34;</span>,<span style=color:#e6db74>&#34;test6&#34;</span>,<span style=color:#e6db74>&#34;test7&#34;</span>,<span style=color:#e6db74>&#34;test8&#34;</span>,<span style=color:#e6db74>&#34;test9&#34;</span>,<span style=color:#e6db74>&#34;test10&#34;</span>,<span style=color:#e6db74>&#34;test11&#34;</span>,<span style=color:#e6db74>&#34;test12&#34;</span>,<span style=color:#e6db74>&#34;test13&#34;</span>,<span style=color:#e6db74>&#34;test14&#34;</span>,<span style=color:#e6db74>&#34;test15&#34;</span>,<span style=color:#e6db74>&#34;test16&#34;</span>,<span style=color:#e6db74>&#34;test17&#34;</span>,<span style=color:#e6db74>&#34;test18&#34;</span>,<span style=color:#e6db74>&#34;test19&#34;</span>,<span style=color:#e6db74>&#34;test20&#34;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：</p><pre tabindex=0><code>array(20) { [0]=&gt; string(6) &#34;value1&#34; [1]=&gt; string(6) &#34;value2&#34; [2]=&gt; bool(false) [3]=&gt; bool(false) [4]=&gt; bool(false) [5]=&gt; bool(false) [6]=&gt; bool(false) [7]=&gt; bool(false) [8]=&gt; bool(false) [9]=&gt; bool(false) [10]=&gt; bool(false) [11]=&gt; bool(false) [12]=&gt; bool(false) [13]=&gt; bool(false) [14]=&gt; bool(false) [15]=&gt; bool(false) [16]=&gt; bool(false) [17]=&gt; bool(false) [18]=&gt; bool(false) [19]=&gt; bool(false) }
</code></pre><h5 id=293-压测数据对比>2.9.3 压测数据对比
<a class=anchor href=#293-%e5%8e%8b%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 中间件</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_agent.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_agent.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>478</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   8.120 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>65700000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>47800000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    12315.93 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.624 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.081 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          7901.92 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.5      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>214</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.5      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>214</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>2</span>   2.5      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>215</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>215</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 标准集群</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>478</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   13.117 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>65700000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>47800000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    7623.54 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       2.623 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.131 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          4891.28 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.0      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>1</span>    <span style=color:#ae81ff>3</span>   2.4      <span style=color:#ae81ff>2</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>1</span>    <span style=color:#ae81ff>3</span>   2.4      <span style=color:#ae81ff>2</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>1</span>    <span style=color:#ae81ff>3</span>   2.4      <span style=color:#ae81ff>2</span>     <span style=color:#ae81ff>213</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>213</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=210-del指令ok>2.10 DEL指令（OK）
<a class=anchor href=#210-del%e6%8c%87%e4%bb%a4ok>#</a></h4><h5 id=2101-中间件>2.10.1 中间件
<a class=anchor href=#2101-%e4%b8%ad%e9%97%b4%e4%bb%b6>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Redis</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect</span>(<span style=color:#e6db74>&#39;/tmp/redis.socks&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>mset</span>([<span style=color:#e6db74>&#34;test1&#34;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;value1&#39;</span>,<span style=color:#e6db74>&#34;test2&#34;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;value2&#39;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>del</span>(<span style=color:#e6db74>&#34;test1&#34;</span>,<span style=color:#e6db74>&#34;test2&#34;</span>,<span style=color:#e6db74>&#34;test3&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(true) int(2)</p><h5 id=2102-标准集群>2.10.2 标准集群
<a class=anchor href=#2102-%e6%a0%87%e5%87%86%e9%9b%86%e7%be%a4>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//connect 是 异常级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $redis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RedisCluster</span>(<span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>Array</span>(<span style=color:#e6db74>&#34;127.0.0.1:9001&#34;</span>), <span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>1.5</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>mset</span>([<span style=color:#e6db74>&#34;test1&#34;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;value1&#39;</span>,<span style=color:#e6db74>&#34;test2&#34;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;value2&#39;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>    $ret <span style=color:#f92672>=</span> $redis<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>del</span>(<span style=color:#e6db74>&#34;test1&#34;</span>,<span style=color:#e6db74>&#34;test2&#34;</span>,<span style=color:#e6db74>&#34;test3&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ret);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $ex){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_dump</span>($ex<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>运行结果：bool(true) int(2)</p><h5 id=2103-压测数据对比>2.10.3 压测数据对比
<a class=anchor href=#2103-%e5%8e%8b%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 中间件</span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_agent.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_agent.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>7</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   7.240 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>18600000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>700000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    13811.28 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.448 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.072 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          2508.69 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.6      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>215</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.6      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>215</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   2.6      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>215</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>215</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 标准集群</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>corerman@corerman-WorkStation:~$ ab -n <span style=color:#ae81ff>100000</span> -c <span style=color:#ae81ff>20</span> http://lab.test.local/redis_cluster.php
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1807734</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking lab.test.local <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>10000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>20000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>30000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>40000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>50000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>60000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>70000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>80000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>90000</span> requests
</span></span><span style=display:flex><span>Completed <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>Finished <span style=color:#ae81ff>100000</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Software:        nginx
</span></span><span style=display:flex><span>Server Hostname:        lab.test.local
</span></span><span style=display:flex><span>Server Port:            <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Document Path:          /redis_cluster.php
</span></span><span style=display:flex><span>Document Length:        <span style=color:#ae81ff>7</span> bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#66d9ef>for</span> tests:   6.447 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Total transferred:      <span style=color:#ae81ff>18600000</span> bytes
</span></span><span style=display:flex><span>HTML transferred:       <span style=color:#ae81ff>700000</span> bytes
</span></span><span style=display:flex><span>Requests per second:    15511.04 <span style=color:#f92672>[</span><span style=color:#75715e>#/sec] (mean)</span>
</span></span><span style=display:flex><span>Time per request:       1.289 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time per request:       0.064 <span style=color:#f92672>[</span>ms<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>mean, across all concurrent requests<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Transfer rate:          2817.44 <span style=color:#f92672>[</span>Kbytes/sec<span style=color:#f92672>]</span> received
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection Times <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              min  mean<span style=color:#f92672>[</span>+/-sd<span style=color:#f92672>]</span> median   max
</span></span><span style=display:flex><span>Connect:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>   0.1      <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Processing:     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   3.1      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>216</span>
</span></span><span style=display:flex><span>Waiting:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   3.1      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>216</span>
</span></span><span style=display:flex><span>Total:          <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>   3.1      <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>216</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Percentage of the requests served within a certain time <span style=color:#f92672>(</span>ms<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  50%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  66%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  75%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  80%      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  90%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  95%      <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  98%      <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  99%      <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span> 100%    <span style=color:#ae81ff>216</span> <span style=color:#f92672>(</span>longest request<span style=color:#f92672>)</span>
</span></span></code></pre></div><h1 id=redishub-与-phpredis集群客户端指令效果对比>RedisHub 与 phpredis集群客户端指令效果对比
<a class=anchor href=#redishub-%e4%b8%8e-phpredis%e9%9b%86%e7%be%a4%e5%ae%a2%e6%88%b7%e7%ab%af%e6%8c%87%e4%bb%a4%e6%95%88%e6%9e%9c%e5%af%b9%e6%af%94>#</a></h1><h2 id=一-set指令-保持一致>一. set指令 （保持一致）
<a class=anchor href=#%e4%b8%80-set%e6%8c%87%e4%bb%a4-%e4%bf%9d%e6%8c%81%e4%b8%80%e8%87%b4>#</a></h2><ol><li>正常：true</li><li>节点损坏：报异常</li><li>clusterDown：返回异常，clusterdown异常</li></ol><h2 id=二mset-保持一致>二、mset （保持一致）
<a class=anchor href=#%e4%ba%8cmset-%e4%bf%9d%e6%8c%81%e4%b8%80%e8%87%b4>#</a></h2><ol><li>正常 ：true</li><li>节点损坏：报异常</li><li>clusterDown：返回异常，clusterdown异常</li></ol><h2 id=三get-保持一致>三、get （保持一致）
<a class=anchor href=#%e4%b8%89get-%e4%bf%9d%e6%8c%81%e4%b8%80%e8%87%b4>#</a></h2><ol><li>正常：数据</li><li>节点损坏：报异常</li><li>clusterDown：返回异常，clusterdown异常</li></ol><h2 id=四mget-节点损坏时有区别redishub更合理>四、mget （节点损坏时有区别，redishub更合理）
<a class=anchor href=#%e5%9b%9bmget-%e8%8a%82%e7%82%b9%e6%8d%9f%e5%9d%8f%e6%97%b6%e6%9c%89%e5%8c%ba%e5%88%abredishub%e6%9b%b4%e5%90%88%e7%90%86>#</a></h2><ol><li>正常：返回数据 ，无数据时为false</li><li>节点损坏： phpredis全部不返回，redishub针对存活的数据节点返回数据，不存活的节点返回nil及false</li><li>clusterDown：返回异常，clusterdown异常</li></ol><h3 id=五del>五、DEL
<a class=anchor href=#%e4%ba%94del>#</a></h3><ol><li><p>正常：返回删除数据量</p></li><li><p>节点损坏：phpredis报异常、redishub针对存活的数据节点进行数据删除，并统计数量返回，redishub不报异常</p></li><li><p>clusterDown：返回异常，clusterdown异常</p></li></ol><h3 id=六rpush指令-保持一致>六.rpush指令 （保持一致）
<a class=anchor href=#%e5%85%adrpush%e6%8c%87%e4%bb%a4-%e4%bf%9d%e6%8c%81%e4%b8%80%e8%87%b4>#</a></h3><ol><li><p>正常 返回：统计量</p></li><li><p>节点损坏：报异常</p></li><li><p>clusterDown：返回异常，clusterdown异常</p></li></ol><h3 id=七lpop指令-保持一致>七.lpop指令 （保持一致）
<a class=anchor href=#%e4%b8%83lpop%e6%8c%87%e4%bb%a4-%e4%bf%9d%e6%8c%81%e4%b8%80%e8%87%b4>#</a></h3><ol><li>正常 返回：统计量</li><li>节点损坏：报异常</li><li>clusterDown：返回异常，clusterdown异常</li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#零亿级数据压测>零、亿级数据压测</a></li><li><a href=#一redis基准压测性能对比>一、Redis基准压测性能对比</a></li><li><a href=#二-中间件和标准集群下phpredis的表现及性能>二. 中间件和标准集群下，phpredis的表现及性能</a></li></ul></li></ul><ul><li><a href=#一-set指令-保持一致>一. set指令 （保持一致）</a></li><li><a href=#二mset-保持一致>二、mset （保持一致）</a></li><li><a href=#三get-保持一致>三、get （保持一致）</a></li><li><a href=#四mget-节点损坏时有区别redishub更合理>四、mget （节点损坏时有区别，redishub更合理）</a><ul><li><a href=#五del>五、DEL</a></li><li><a href=#六rpush指令-保持一致>六.rpush指令 （保持一致）</a></li><li><a href=#七lpop指令-保持一致>七.lpop指令 （保持一致）</a></li></ul></li></ul></nav></div></aside></main></body></html>